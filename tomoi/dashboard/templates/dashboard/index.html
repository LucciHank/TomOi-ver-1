{% extends 'dashboard/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Tổng quan{% endblock %}

{% block extra_css %}
<link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<style>
    /* Card Styling nâng cấp */
    .dashboard-card {
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: none;
        overflow: hidden;
        background: linear-gradient(145deg, #ffffff, #f8f9fc);
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
    }
    
    /* Icons thống kê */
    .stats-icon {
        width: 55px;
        height: 55px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        font-size: 24px;
        margin-bottom: 1rem;
        color: white;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        transition: all 0.4s ease;
    }
    
    .icon-primary { background-color: #df2626; }
    .icon-success { background-color: #1cc88a; }
    .icon-info { background-color: #36b9cc; }
    .icon-warning { background-color: #f6c23e; }
    
    /* Sửa lỗi lịch không hiển thị và điều chỉnh chiều cao */
    .calendar-container {
        padding: 0;
        overflow: hidden;
        position: relative;
        height: 600px !important;
        border-radius: 0 0 0.35rem 0.35rem;
    }
    
    #calendar {
        height: 100% !important;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    /* Đảm bảo các khối có chiều cao đồng đều */
    .equal-height-row {
        display: flex;
        flex-wrap: wrap;
    }
    
    .equal-height-row > div {
        display: flex;
        flex-direction: column;
    }
    
    .equal-height-row .card {
        flex: 1;
        margin-bottom: 20px;
    }
    
    /* Cân đối chiều cao của các biểu đồ */
    .chart-card {
        height: 300px;
        margin-bottom: 20px;
        overflow: hidden;
    }
    
    .card-chart-container {
        position: relative;
        height: 100%;
        width: 100%;
    }
    
    /* Đảm bảo modals chỉ hiển thị trong phạm vi block */
    .card {
        position: relative;
        overflow: visible;
    }
    
    .dropdown-menu {
        position: absolute;
        z-index: 1000;
    }
    
    /* Sửa lỗi dropdown menu bị che khuất */
    .card-header {
        position: relative;
        z-index: 10;
    }
    
    .dropdown-menu-right {
        right: 0;
        left: auto;
    }
    
    /* Calendar container */
    .calendar-container {
        padding: 0;
        overflow: hidden;
        border-radius: 0 0 0.35rem 0.35rem;
    }
    
    #calendar {
        height: 550px !important;
        width: 100%;
        font-family: 'Nunito', sans-serif;
    }
    
    .fc-header-toolbar {
        padding: 1rem;
        background: linear-gradient(to right, #f8f9fc, #eaecf4);
        border-bottom: 1px solid #e3e6f0;
    }
    
    .fc-button-primary {
        background-color: #4e73df !important;
        border-color: #4e73df !important;
        box-shadow: 0 2px 5px rgba(78, 115, 223, 0.2) !important;
        transition: all 0.2s ease;
    }
    
    .fc-button-primary:hover {
        background-color: #2e59d9 !important;
        border-color: #2653d4 !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(78, 115, 223, 0.3) !important;
    }
    
    .fc-button-active {
        background-color: #2e59d9 !important;
        border-color: #2653d4 !important;
        box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125) !important;
    }
    
    .fc-day-today {
        background-color: rgba(78, 115, 223, 0.05) !important;
    }
    
    .fc-event {
        border-radius: 4px;
        border: none;
        padding: 3px;
        font-size: 0.85em;
        transition: transform 0.2s ease;
        cursor: pointer;
    }
    
    .fc-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }
    
    .fc-daygrid-day-number {
        font-weight: 600;
        color: #5a5c69;
    }
    
    .fc-daygrid-day-top {
        justify-content: center;
    }
    
    .fc-col-header-cell-cushion {
        font-weight: 700;
        color: #4e73df;
    }
    
    /* Hiệu ứng kéo chọn khoảng thời gian */
    .fc-highlight {
        background-color: rgba(78, 115, 223, 0.2) !important;
        border: 2px dashed #4e73df;
    }
    
    /* Nút thêm sự kiện cố định */
    .btn-add-event {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        background: linear-gradient(45deg, #4e73df, #2653d4);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(78, 115, 223, 0.4);
        cursor: pointer;
        border: none;
        z-index: 1000;
        transition: all 0.3s ease;
    }
    
    .btn-add-event:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 6px 30px rgba(78, 115, 223, 0.6);
    }
    
    .btn-add-event i {
        font-size: 24px;
    }
    
    /* Cải thiện bố cục 3 khối */
    .dashboard-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -0.75rem;
        margin-left: -0.75rem;
    }
    
    .dashboard-col {
        position: relative;
        width: 100%;
        padding-right: 0.75rem;
        padding-left: 0.75rem;
    }
    
    .dashboard-col-calendar {
        flex: 0 0 50%;
        max-width: 50%;
    }
    
    .dashboard-col-charts {
        flex: 0 0 50%;
        max-width: 50%;
        display: flex;
        flex-direction: column;
    }
    
    @media (max-width: 1200px) {
        .dashboard-col-calendar, .dashboard-col-charts {
            flex: 0 0 100%;
            max-width: 100%;
        }
    }
    
    /* Tooltip cho sự kiện */
    .fc-event-title {
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* Hiệu ứng hover cho ngày */
    .fc-daygrid-day:hover {
        background-color: rgba(78, 115, 223, 0.05);
    }
    
    /* Cải thiện modal thêm sự kiện */
    #addEventModal .modal-content {
        border: none;
        border-radius: 0.5rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    #addEventModal .modal-header {
        background: linear-gradient(to right, #4e73df, #224abe);
        color: white;
        border-radius: 0.5rem 0.5rem 0 0;
    }
    
    #addEventModal .modal-footer {
        border-top: 1px solid #e3e6f0;
        background-color: #f8f9fc;
        border-radius: 0 0 0.5rem 0.5rem;
    }
    
    #addEventModal .btn-primary {
        background-color: #4e73df;
        border-color: #4e73df;
    }
    
    #addEventModal .btn-primary:hover {
        background-color: #2e59d9;
        border-color: #2653d4;
    }
    
    /* Cải thiện biểu đồ doanh thu */
    .chart-area {
        position: relative;
        height: 250px !important;
        width: 100%;
        overflow: hidden;
    }
    
    /* Tab phần premium */
    .premium-tabs .nav-link {
        border-radius: 8px 8px 0 0;
        padding: 10px 20px;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.2s ease;
    }
    
    .premium-tabs .nav-link.active {
        background-color: #fff;
        color: #df2626;
        border-color: #e3e6f0 #e3e6f0 #fff;
    }
    
    .premium-tabs .nav-link:hover:not(.active) {
        background-color: rgba(0,0,0,0.02);
    }
    
    /* Method select */
    .method-select {
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 8px;
    }
    
    .method-select:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .method-select.selected {
        background-color: rgba(223, 38, 38, 0.1);
        border-color: #df2626 !important;
        transform: translateY(-3px);
    }
    
    /* Toast container */
    #toastContainer {
        z-index: 9999;
    }
    
    .toast {
        opacity: 0;
        animation: fadeIn 0.3s ease forwards;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Điều chỉnh cho calendar */
    .fc-theme-standard .fc-scrollgrid {
        border-radius: 8px;
        overflow: hidden;
    }
    
    .fc .fc-daygrid-day.fc-day-today {
        background-color: rgba(223, 38, 38, 0.1) !important;
    }
    
    .fc-event {
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.2s ease;
    }
    
    .fc-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Detail icon */
    .detail-icon {
        transition: all 0.3s ease;
        color: #4e73df;
    }
    
    .detail-icon:hover {
        transform: scale(1.2);
        color: #df2626;
    }
    
    /* Datatable styling */
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background: #df2626 !important;
        color: white !important;
        border-color: #c51d1d !important;
        border-radius: 5px;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background: #f4f4f4 !important;
        color: #df2626 !important;
        border-radius: 5px;
    }
    
    /* Tabs animation */
    .tab-pane.fade {
        transition: opacity 0.3s ease-in-out;
    }
    
    /* Biểu đồ styling */
    .chart-container {
        position: relative;
        margin: auto;
        height: 300px;
        transition: all 0.3s ease;
    }
    
    /* Nút in lịch */
    .print-calendar {
        background-color: #fff;
        color: #4e73df;
        border: 1px solid #4e73df;
        border-radius: 5px;
        padding: 5px 15px;
        transition: all 0.3s ease;
    }
    
    .print-calendar:hover {
        background-color: #4e73df;
        color: white;
    }
    
    /* Nút đồng bộ Google */
    .sync-google {
        background: linear-gradient(45deg, #4285F4, #0F9D58);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 5px 15px;
        transition: all 0.3s ease;
    }
    
    .sync-google:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    /* Cải thiện hiển thị trạng thái đơn hàng */
    .order-status {
        color: #fff;
        font-weight: 600;
        padding: 5px 10px;
        border-radius: 5px;
        display: inline-block;
        font-size: 0.85rem;
    }
    
    .status-completed { background-color: #1cc88a; }
    .status-shipping { background-color: #36b9cc; }
    .status-processing { background-color: #4e73df; }
    .status-cancelled { background-color: #e74a3b; }
    .status-pending { background-color: #f6c23e; }
    
    /* Làm đẹp bảng đơn hàng */
    .orders-table tr {
        transition: all 0.2s ease;
    }
    
    .orders-table tr:hover {
        background-color: rgba(0,0,0,0.02);
    }
    
    .view-order-btn {
        width: 32px;
        height: 32px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    
    .view-order-btn:hover {
        background-color: #4e73df;
        color: white;
    }
    
    /* Premium subscription table */
    .premium-table tr {
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .premium-table tr:hover {
        background-color: rgba(0,0,0,0.02);
    }
    
    /* Tooltip cải tiến */
    .custom-tooltip {
        position: relative;
        display: inline-block;
    }
    
    .custom-tooltip .tooltip-text {
        visibility: hidden;
        width: 200px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .custom-tooltip .tooltip-text::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #333 transparent transparent transparent;
    }
    
    .custom-tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
    }
    
    /* Cải thiện hiệu ứng cho bảng đơn hàng gần đây */
    .table-hover tbody tr {
        transition: all 0.2s ease;
    }
    
    .table-hover tbody tr:hover {
        background-color: rgba(78, 115, 223, 0.05);
        transform: translateX(5px);
    }
    
    /* Badge trạng thái đơn hàng */
    .badge {
        padding: 0.5em 0.75em;
        font-weight: 600;
        border-radius: 30px;
    }
    
    .badge-success {
        background-color: #1cc88a;
        color: white;
    }
    
    .badge-warning {
        background-color: #f6c23e;
        color: white;
    }
    
    .badge-danger {
        background-color: #e74a3b;
        color: white;
    }
    
    .badge-primary {
        background-color: #4e73df;
        color: white;
    }
    
    /* Bổ sung class cho badge mới */
    .badge-info {
        background-color: #36b9cc;
        color: white;
    }
    
    /* Cải thiện nút chi tiết */
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        line-height: 1.5;
        border-radius: 0.2rem;
    }
    
    .btn-primary {
        background-color: #4e73df;
        border-color: #4e73df;
    }
    
    .btn-primary:hover {
        background-color: #2e59d9;
        border-color: #2653d4;
    }
</style>
{% endblock %}

{% block content %}
{% csrf_token %}
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Tổng quan</h1>
        <div>
            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm mr-2" id="syncWithGoogle">
                <i class="fas fa-sync fa-sm text-white-50 mr-1"></i> Đồng bộ với Google
            </a>
            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="printCalendar">
                <i class="fas fa-print fa-sm text-white-50 mr-1"></i> In lịch
            </a>
        </div>
    </div>

    <!-- Thống kê tổng quan -->
    <div class="row mb-4">
        <!-- Tổng doanh thu -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Doanh thu (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">50.000.000đ</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>12% so với tháng trước</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-primary">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tổng đơn hàng -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Đơn hàng (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">215</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>8% so với tháng trước</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-success">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Người dùng mới -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Người dùng mới (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">82</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>5% so với tháng trước</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-info">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tài khoản Premium -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Tài khoản Premium</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">45</div>
                            <div class="text-xs text-danger mt-2">
                                <i class="fas fa-clock mr-1"></i>
                                <span>8 gói sắp hết hạn</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-warning">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bố cục mới với chiều cao đồng đều -->
    <div class="row equal-height-row">
        <!-- Khối lịch sự kiện -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow h-100">
                <!-- Thêm thông tin trạng thái đồng bộ vào header của khối lịch -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        Lịch sự kiện và nhắc nhở 
                        <span class="ml-2" id="syncStatus"></span>
                    </h6>
                    <div>
                        <small id="lastSyncTime" class="text-muted mr-2"></small>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="calendarDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="calendarDropdown">
                                <div class="dropdown-header">Tùy chọn:</div>
                                <a class="dropdown-item" href="#" id="syncWithGoogleDropdown">
                                    <i class="fas fa-sync fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Đồng bộ với Google
                                </a>
                                <a class="dropdown-item" href="#" id="printCalendarDropdown">
                                    <i class="fas fa-print fa-sm fa-fw mr-2 text-gray-400"></i>
                                    In lịch
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body calendar-container p-0">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
        
        <!-- Khối biểu đồ bên phải -->
        <div class="col-xl-6 col-lg-6">
            <!-- Biểu đồ doanh thu -->
            <div class="card shadow chart-card">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Doanh thu</h6>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary time-filter-btn active" data-filter="month">Tháng</button>
                        <button type="button" class="btn btn-sm btn-outline-primary time-filter-btn" data-filter="quarter">Quý</button>
                        <button type="button" class="btn btn-sm btn-outline-primary time-filter-btn" data-filter="year">Năm</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" id="exportRevenueBtn">
                            <i class="fas fa-file-export fa-sm"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area card-chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Biểu đồ lợi nhuận -->
            <div class="card shadow chart-card">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Lợi nhuận</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="profitDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="profitDropdown">
                            <div class="dropdown-header">Tùy chọn:</div>
                            <a class="dropdown-item" href="#" id="exportProfitBtn">
                                <i class="fas fa-file-export fa-sm fa-fw mr-2 text-gray-400"></i>
                                Xuất báo cáo
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area card-chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Thêm hàng mới với đơn hàng gần đây và trạng thái đơn hàng -->
    <div class="row equal-height-row">
        <!-- Đơn hàng gần đây -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow h-100">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Đơn hàng gần đây</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="ordersDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="ordersDropdown">
                            <div class="dropdown-header">Tùy chọn:</div>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-shopping-cart fa-sm fa-fw mr-2 text-gray-400"></i>
                                Xem tất cả đơn hàng
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Mã đơn</th>
                                    <th>Khách hàng</th>
                                    <th>Ngày đặt</th>
                                    <th>Tổng tiền</th>
                                    <th>Trạng thái</th>
                                    <th>Chi tiết</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#ORD-4872</td>
                                    <td>Nguyễn Văn A</td>
                                    <td>20/07/2023</td>
                                    <td>1.500.000đ</td>
                                    <td><span class="badge badge-success">Hoàn thành</span></td>
                                    <td><a href="#" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a></td>
                                </tr>
                                <tr>
                                    <td>#ORD-4871</td>
                                    <td>Trần Thị B</td>
                                    <td>19/07/2023</td>
                                    <td>2.700.000đ</td>
                                    <td><span class="badge badge-info">Đang giao</span></td>
                                    <td><a href="#" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a></td>
                                </tr>
                                <tr>
                                    <td>#ORD-4870</td>
                                    <td>Lê Văn C</td>
                                    <td>19/07/2023</td>
                                    <td>850.000đ</td>
                                    <td><span class="badge badge-primary">Đang xử lý</span></td>
                                    <td><a href="#" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a></td>
                                </tr>
                                <tr>
                                    <td>#ORD-4869</td>
                                    <td>Phạm Thị D</td>
                                    <td>18/07/2023</td>
                                    <td>3.200.000đ</td>
                                    <td><span class="badge badge-danger">Đã hủy</span></td>
                                    <td><a href="#" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a></td>
                                </tr>
                                <tr>
                                    <td>#ORD-4868</td>
                                    <td>Hoàng Văn E</td>
                                    <td>17/07/2023</td>
                                    <td>1.200.000đ</td>
                                    <td><span class="badge badge-success">Hoàn thành</span></td>
                                    <td><a href="#" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Trạng thái đơn hàng -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow h-100">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Trạng thái đơn hàng</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="statusDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="statusDropdown">
                            <div class="dropdown-header">Tùy chọn:</div>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-chart-pie fa-sm fa-fw mr-2 text-gray-400"></i>
                                Xem báo cáo đầy đủ
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area card-chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nút thêm sự kiện cố định -->
    <button class="btn-add-event" id="addEventBtn" title="Thêm sự kiện mới">
        <i class="fas fa-plus"></i>
    </button>
</div>

<!-- Đơn hàng gần đây và biểu đồ -->
<div class="row">
    <!-- Biểu đồ tròn trạng thái đơn hàng -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Trạng thái đơn hàng</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="orderStatsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="orderStatsDropdown">
                        <div class="dropdown-header">Thời gian:</div>
                        <a class="dropdown-item active" href="#">Hôm nay</a>
                        <a class="dropdown-item" href="#">Tuần này</a>
                        <a class="dropdown-item" href="#">Tháng này</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="orderStatusChart"></canvas>
                </div>
                <div class="mt-4 text-center small">
                    <span class="mr-2">
                        <i class="fas fa-circle text-success"></i> Hoàn thành
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-primary"></i> Đang giao
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-warning"></i> Đang xử lý
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-danger"></i> Đã hủy
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Đơn hàng gần đây -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Đơn hàng gần đây</h6>
                <a href="{% url 'dashboard:index' %}" class="btn btn-sm btn-primary">
                    Xem tất cả
                </a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table orders-table" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Mã đơn</th>
                                <th>Khách hàng</th>
                                <th>Ngày đặt</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="order-row" data-order-id="4872">
                                <td>#ORD-4872</td>
                                <td>Nguyễn Văn A</td>
                                <td>20/07/2023</td>
                                <td>1.500.000đ</td>
                                <td><span class="order-status status-completed">Hoàn thành</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light view-order-btn" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="order-row" data-order-id="4871">
                                <td>#ORD-4871</td>
                                <td>Trần Thị B</td>
                                <td>19/07/2023</td>
                                <td>2.700.000đ</td>
                                <td><span class="order-status status-shipping">Đang giao</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light view-order-btn" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="order-row" data-order-id="4870">
                                <td>#ORD-4870</td>
                                <td>Lê Văn C</td>
                                <td>19/07/2023</td>
                                <td>850.000đ</td>
                                <td><span class="order-status status-processing">Đang xử lý</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light view-order-btn" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="order-row" data-order-id="4869">
                                <td>#ORD-4869</td>
                                <td>Phạm Thị D</td>
                                <td>18/07/2023</td>
                                <td>3.200.000đ</td>
                                <td><span class="order-status status-cancelled">Đã hủy</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light view-order-btn" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="order-row" data-order-id="4868">
                                <td>#ORD-4868</td>
                                <td>Hoàng Văn E</td>
                                <td>17/07/2023</td>
                                <td>1.200.000đ</td>
                                <td><span class="order-status status-completed">Hoàn thành</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light view-order-btn" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tài khoản Premium -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <ul class="nav nav-tabs" id="subscriptionTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link subscription-tab" id="today-tab" data-bs-toggle="tab" href="#today" role="tab" aria-controls="today" aria-selected="true">
                    Hôm nay <span class="badge bg-danger ml-1" id="todayCount">0</span>
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link subscription-tab" id="upcoming-tab" data-bs-toggle="tab" href="#upcoming" role="tab" aria-controls="upcoming" aria-selected="false">
                    Sắp tới <span class="badge bg-warning ml-1" id="upcomingCount">0</span>
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link subscription-tab" id="expired-tab" data-bs-toggle="tab" href="#expired" role="tab" aria-controls="expired" aria-selected="false">
                    Đã hết hạn <span class="badge bg-secondary ml-1" id="expiredCount">0</span>
                </a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="subscriptionTabsContent">
            <!-- Tab Hôm nay -->
            <div class="tab-pane fade show active" id="today" role="tabpanel" aria-labelledby="today-tab">
                <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="todayTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody id="todayTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tab Sắp tới -->
            <div class="tab-pane fade" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
                <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="upcomingTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                <th>Còn lại</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody id="upcomingTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tab Quá hạn -->
            <div class="tab-pane fade" id="expired" role="tabpanel" aria-labelledby="expired-tab">
                <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="expiredTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                <th>Quá hạn</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody id="expiredTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cập nhật modal thêm sự kiện -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEventModalLabel">Thêm sự kiện mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addEventForm">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Tiêu đề</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="eventStartDate" class="form-label">Ngày bắt đầu</label>
                            <input type="date" class="form-control" id="eventStartDate" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="eventStartTime" class="form-label">Giờ bắt đầu</label>
                            <input type="time" class="form-control" id="eventStartTime">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="eventEndDate" class="form-label">Ngày kết thúc</label>
                            <input type="date" class="form-control" id="eventEndDate">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="eventEndTime" class="form-label">Giờ kết thúc</label>
                            <input type="time" class="form-control" id="eventEndTime">
                        </div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allDayEvent">
                        <label class="form-check-label" for="allDayEvent">Cả ngày</label>
                    </div>
                    <div class="mb-3">
                        <label for="eventDescription" class="form-label">Mô tả</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="eventColor" class="form-label">Màu sắc</label>
                        <select class="form-control" id="eventColor">
                            <option value="#df2626">Đỏ</option>
                            <option value="#1cc88a">Xanh lá</option>
                            <option value="#4e73df">Xanh dương</option>
                            <option value="#f6c23e">Vàng</option>
                            <option value="#6f42c1">Tím</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveEventBtn">
                    <i class="fas fa-save"></i> Lưu sự kiện
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Chi tiết Sự kiện -->
<div class="modal fade" id="eventDetailModal" tabindex="-1" role="dialog" aria-labelledby="eventDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventDetailModalLabel">Chi tiết sự kiện</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="eventDetailContent">
                <!-- Nội dung chi tiết sự kiện sẽ được hiển thị ở đây -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-danger d-none" id="deleteEventBtn">Xóa sự kiện</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Chi tiết đơn hàng -->
<div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailModalLabel">Chi tiết đơn hàng</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="orderDetailContent">
        <!-- Nội dung sẽ được điền bởi JavaScript -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary">Xem chi tiết</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Nhắc nhở Gia hạn -->
<div class="modal fade" id="reminderModal" tabindex="-1" role="dialog" aria-labelledby="reminderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reminderModalLabel">Gửi nhắc nhở gia hạn</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h6 class="font-weight-bold mb-3">Chọn phương thức gửi thông báo</h6>
                <input type="hidden" id="subscriptionId" value="">
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="email">
                            <i class="fas fa-envelope fa-2x mb-2 text-primary"></i>
                            <h6>Email</h6>
                            <small>Gửi email nhắc gia hạn</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="sms">
                            <i class="fas fa-sms fa-2x mb-2 text-success"></i>
                            <h6>SMS</h6>
                            <small>Gửi SMS tới điện thoại</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="zalo">
                            <i class="fab fa-facebook-messenger fa-2x mb-2 text-info"></i>
                            <h6>Zalo</h6>
                            <small>Gửi tin nhắn qua Zalo</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4">
                    <label for="reminderMessage">Nội dung nhắc nhở:</label>
                    <textarea class="form-control" id="reminderMessage" rows="4" placeholder="Nhập nội dung tin nhắn nhắc nhở gia hạn...">Thông báo: Tài khoản Premium của bạn sắp hết hạn. Vui lòng gia hạn để tiếp tục sử dụng dịch vụ.</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="sendReminderBtn">Gửi nhắc nhở</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

<!-- Modal Khảo sát lý do không gia hạn -->
<div class="modal fade" id="surveyModal" tabindex="-1" role="dialog" aria-labelledby="surveyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="surveyModalLabel">Khảo sát lý do không gia hạn</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="mb-4">Quý khách vui lòng cho biết lý do không tiếp tục gia hạn dịch vụ Premium:</p>
                
                <form id="surveyForm">
                    <input type="hidden" id="surveySubscriptionId" value="">
                    
                    <div class="form-group">
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason1" value="no_budget">
                            <label class="custom-control-label" for="reason1">Tôi không có đủ chi phí để gia hạn</label>
                            <div class="mt-2 ml-4 small text-primary d-none" id="tcoinInfo">
                                <i class="fas fa-info-circle mr-1"></i> Có thể bạn chưa biết: TomOi.vn hỗ trợ bạn điểm danh hàng ngày và làm nhiệm vụ để nhận TCoin, giúp bạn có thể mua tài khoản Premium với giá 0 đồng.
                                <a href="/accounts/tcoin/" class="font-weight-bold">Tìm hiểu ngay</a>
                            </div>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason2" value="not_satisfied">
                            <label class="custom-control-label" for="reason2">Tôi cảm thấy chưa hài lòng về dịch vụ</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason3" value="not_worth">
                            <label class="custom-control-label" for="reason3">Tôi cảm thấy sản phẩm không xứng với số tiền bỏ ra</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason4" value="bugs">
                            <label class="custom-control-label" for="reason4">Sản phẩm hay bị lỗi</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason5" value="slow_warranty">
                            <label class="custom-control-label" for="reason5">Thời gian bảo hành lâu</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason6" value="better_price">
                            <label class="custom-control-label" for="reason6">Tôi tìm được nơi khác có mức giá rẻ hơn</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason7" value="dont_like_sharing">
                            <label class="custom-control-label" for="reason7">Tôi không thích sản phẩm dùng chung</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason8" value="security_concerns">
                            <label class="custom-control-label" for="reason8">Tôi cảm thấy không yên tâm về bảo mật</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason9" value="rarely_use">
                            <label class="custom-control-label" for="reason9">Tôi ít sử dụng sản phẩm nên không cần thiết nữa</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason10" value="want_better">
                            <label class="custom-control-label" for="reason10">Tôi muốn đổi sang sản phẩm khác tốt hơn</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input" id="reasonOther">
                            <label class="custom-control-label" for="reasonOther">Khác</label>
                            <div class="mt-2 ml-4 d-none" id="otherReasonContainer">
                                <textarea class="form-control" id="otherReason" rows="2" placeholder="Vui lòng cho biết lý do cụ thể..."></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="submitSurveyBtn">Gửi khảo sát</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal thông báo hủy gia hạn thành công -->
<div class="modal fade" id="cancelSuccessModal" tabindex="-1" role="dialog" aria-labelledby="cancelSuccessModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="cancelSuccessModalLabel">Hủy gia hạn thành công</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 64px;"></i>
                </div>
                <p class="text-center mb-4">Bạn đã hủy gia hạn dịch vụ Premium thành công.</p>
                <p class="text-center">Bạn đã nhận được <strong>+50 TCoin</strong> vào tài khoản. Cảm ơn bạn đã tham gia khảo sát!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/locales/vi.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(document).ready(function() {
    // ======= KHỞI TẠO BIỂU ĐỒ DOANH THU =======
    var revenueCtx = document.getElementById('revenueChart');
    
    if (revenueCtx) {
        var revenueChart = new Chart(revenueCtx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                datasets: [{
                    label: 'Doanh thu',
                    data: [5000000, 7500000, 8200000, 7800000, 9000000, 12000000, 11500000, 10800000, 13200000, 14500000, 15800000, 18000000],
                    borderColor: '#4e73df',
                    backgroundColor: 'rgba(78, 115, 223, 0.05)',
                    pointBackgroundColor: '#4e73df',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#4e73df',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    },
                    y: {
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', maximumFractionDigits: 0 }).format(value);
                            }
                        },
                        grid: {
                            color: "rgb(234, 236, 244)",
                            drawBorder: false,
                            borderDash: [2],
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Doanh thu: ' + new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', maximumFractionDigits: 0 }).format(context.raw);
                            }
                        }
                    }
                }
            }
        });
        
        // Dữ liệu doanh thu theo quý và năm
        var quarterlyData = {
            labels: ['Quý 1', 'Quý 2', 'Quý 3', 'Quý 4'],
            data: [20700000, 28800000, 35500000, 48300000]
        };
        
        var yearlyData = {
            labels: ['2020', '2021', '2022', '2023', '2024', '2025'],
            data: [85000000, 110000000, 133000000, 156000000, 178000000, 133300000]
        };
        
        var monthlyData = {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            data: [5000000, 7500000, 8200000, 7800000, 9000000, 12000000, 11500000, 10800000, 13200000, 14500000, 15800000, 18000000]
        };
        
        // Xử lý nút lọc thời gian
        $('.time-filter-btn').on('click', function() {
            // Loại bỏ active class từ tất cả các nút
            $('.time-filter-btn').removeClass('active');
            // Thêm active class vào nút được click
            $(this).addClass('active');
            
            // Lấy loại filter
            var filterType = $(this).data('filter');
            
            // Ẩn biểu đồ với hiệu ứng fade
            $('#revenueChart').css('opacity', '0.3');
            
            // Đợi 300ms cho hiệu ứng fade
            setTimeout(function() {
                // Cập nhật dữ liệu và nhãn cho biểu đồ dựa trên loại filter
                if (filterType === 'month') {
                    updateChartData(revenueChart, monthlyData.labels, monthlyData.data);
                } else if (filterType === 'quarter') {
                    updateChartData(revenueChart, quarterlyData.labels, quarterlyData.data);
                } else if (filterType === 'year') {
                    updateChartData(revenueChart, yearlyData.labels, yearlyData.data);
                }
                
                // Hiển thị lại biểu đồ
                $('#revenueChart').css('opacity', '1');
            }, 300);
        });
    }
    
    // ======= KHỞI TẠO BIỂU ĐỒ TRẠNG THÁI ĐƠN HÀNG =======
    var orderStatusCtx = document.getElementById('orderStatusChart');
    if (orderStatusCtx) {
        var orderStatusChart = new Chart(orderStatusCtx.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Hoàn thành', 'Đang xử lý', 'Đã hủy', 'Chờ thanh toán'],
                datasets: [{
                    data: [58, 25, 10, 7],
                    backgroundColor: ['#1cc88a', '#4e73df', '#e74a3b', '#f6c23e'],
                    hoverBackgroundColor: ['#169e6e', '#2e59d9', '#c9362a', '#daa520'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} đơn (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Hàm cập nhật dữ liệu biểu đồ
    function updateChartData(chart, labels, data) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = data;
        chart.update();
    }
    
    // ======= KHỞI TẠO FULLCALENDAR =======
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        
        if (calendarEl) {
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'vi',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                },
                buttonText: {
                    today: 'Hôm nay',
                    month: 'Tháng',
                    week: 'Tuần',
                    day: 'Ngày',
                    list: 'Danh sách'
                },
                height: 'auto',
                navLinks: true,
                editable: true,
                selectable: true,
                nowIndicator: true,
                dayMaxEvents: true,
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false
                },
                events: [
                    {
                        id: '1',
                        title: 'Họp đội ngũ phát triển',
                        start: '2023-07-20T10:00:00',
                        end: '2023-07-20T12:00:00',
                        className: 'bg-primary',
                        extendedProps: {
                            description: 'Thảo luận về các tính năng mới của ứng dụng',
                            type: 'meeting'
                        }
                    },
                    {
                        id: '2',
                        title: 'Hạn chót dự án website',
                        start: '2023-07-25',
                        allDay: true,
                        className: 'bg-danger',
                        extendedProps: {
                            description: 'Hoàn thiện và giao nộp dự án website cho khách hàng',
                            type: 'deadline'
                        }
                    },
                    {
                        id: '3',
                        title: 'Nhắc nhở: Thanh toán chi phí server',
                        start: '2023-07-15',
                        allDay: true,
                        className: 'bg-warning',
                        extendedProps: {
                            description: 'Thanh toán phí gia hạn server hàng tháng',
                            type: 'reminder'
                        }
                    }
                ],
                // Xử lý khi click vào ngày
                dateClick: function(info) {
                    showAddEventModal(info.dateStr, info.dateStr);
                },
                // Xử lý khi chọn phạm vi ngày
                select: function(info) {
                    showAddEventModal(info.startStr, info.endStr);
                },
                // Xử lý khi click vào sự kiện
                eventClick: function(info) {
                    showEventDetails(info.event);
                }
            });
            
            calendar.render();
            window.calendar = calendar;
        }
    });
    
    // ======= XỬ LÝ THÊM SỰ KIỆN =======
    function showAddEventModal(startDate, endDate) {
        Swal.fire({
            title: 'Thêm sự kiện mới',
            html: `
                <form id="addEventForm" class="text-left">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventType" class="form-label">Loại sự kiện</label>
                        <select class="form-control" id="eventType">
                            <option value="meeting">Cuộc họp</option>
                            <option value="deadline">Hạn chót</option>
                            <option value="reminder">Nhắc nhở</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="eventStartDate" class="form-label">Ngày bắt đầu</label>
                        <input type="date" class="form-control" id="eventStartDate" value="${startDate}">
                    </div>
                    <div class="mb-3">
                        <label for="eventEndDate" class="form-label">Ngày kết thúc</label>
                        <input type="date" class="form-control" id="eventEndDate" value="${endDate}">
                    </div>
                    <div class="mb-3">
                        <label for="eventDescription" class="form-label">Mô tả</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allDayEvent" checked>
                        <label class="form-check-label" for="allDayEvent">Cả ngày</label>
                    </div>
                </form>
            `,
            showCancelButton: true,
            confirmButtonText: 'Lưu',
            cancelButtonText: 'Hủy bỏ',
            preConfirm: () => {
                const title = document.getElementById('eventTitle').value;
                if (!title) {
                    Swal.showValidationMessage('Vui lòng nhập tiêu đề sự kiện');
                    return false;
                }
                return {
                    title: title,
                    start: document.getElementById('eventStartDate').value,
                    end: document.getElementById('eventEndDate').value,
                    description: document.getElementById('eventDescription').value,
                    type: document.getElementById('eventType').value,
                    allDay: document.getElementById('allDayEvent').checked
                };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                addNewEvent(result.value);
            }
        });
    }
    
    // Hàm thêm sự kiện mới
    function addNewEvent(eventData) {
        // Thêm sự kiện mới vào lịch
        const newEvent = {
            id: 'new-' + new Date().getTime(),
            title: eventData.title,
            start: eventData.start,
            end: eventData.end || eventData.start,
            allDay: eventData.allDay,
            className: getEventClassName(eventData.type),
            extendedProps: {
                description: eventData.description,
                type: eventData.type
            }
        };
        
        if (window.calendar) {
            window.calendar.addEvent(newEvent);
            
            // Thông báo thành công
            Swal.fire({
                title: 'Thành công!',
                text: 'Đã thêm sự kiện mới vào lịch',
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
            });
        }
    }
    
    // Hàm hiển thị chi tiết sự kiện
    function showEventDetails(event) {
        Swal.fire({
            title: event.title,
            html: `
                <div class="text-left">
                    <p><strong>Thời gian:</strong> ${formatEventDate(event.start, event.end, event.allDay)}</p>
                    <p><strong>Loại sự kiện:</strong> ${getEventTypeName(event.extendedProps.type)}</p>
                    ${event.extendedProps.description ? `<p><strong>Mô tả:</strong> ${event.extendedProps.description}</p>` : ''}
                </div>
            `,
            showCancelButton: true,
            showDenyButton: true,
            confirmButtonText: 'Chỉnh sửa',
            denyButtonText: 'Xóa',
            cancelButtonText: 'Đóng'
        }).then((result) => {
            if (result.isConfirmed) {
                // Chỉnh sửa sự kiện
                editEvent(event);
            } else if (result.isDenied) {
                // Xóa sự kiện
                deleteEvent(event);
            }
        });
    }
    
    // Hàm chỉnh sửa sự kiện
    function editEvent(event) {
        // Chuẩn bị dữ liệu cho form chỉnh sửa
        const startDate = event.start ? event.start.toISOString().slice(0, 10) : '';
        const endDate = event.end ? event.end.toISOString().slice(0, 10) : startDate;
        
        Swal.fire({
            title: 'Chỉnh sửa sự kiện',
            html: `
                <form id="editEventForm" class="text-left">
                    <div class="mb-3">
                        <label for="editEventTitle" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editEventTitle" value="${event.title}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEventType" class="form-label">Loại sự kiện</label>
                        <select class="form-control" id="editEventType">
                            <option value="meeting" ${event.extendedProps.type === 'meeting' ? 'selected' : ''}>Cuộc họp</option>
                            <option value="deadline" ${event.extendedProps.type === 'deadline' ? 'selected' : ''}>Hạn chót</option>
                            <option value="reminder" ${event.extendedProps.type === 'reminder' ? 'selected' : ''}>Nhắc nhở</option>
                            <option value="other" ${event.extendedProps.type === 'other' ? 'selected' : ''}>Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editEventStartDate" class="form-label">Ngày bắt đầu</label>
                        <input type="date" class="form-control" id="editEventStartDate" value="${startDate}">
                    </div>
                    <div class="mb-3">
                        <label for="editEventEndDate" class="form-label">Ngày kết thúc</label>
                        <input type="date" class="form-control" id="editEventEndDate" value="${endDate}">
                    </div>
                    <div class="mb-3">
                        <label for="editEventDescription" class="form-label">Mô tả</label>
                        <textarea class="form-control" id="editEventDescription" rows="3">${event.extendedProps.description || ''}</textarea>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="editAllDayEvent" ${event.allDay ? 'checked' : ''}>
                        <label class="form-check-label" for="editAllDayEvent">Cả ngày</label>
                    </div>
                </form>
            `,
            showCancelButton: true,
            confirmButtonText: 'Lưu',
            cancelButtonText: 'Hủy bỏ',
            preConfirm: () => {
                const title = document.getElementById('editEventTitle').value;
                if (!title) {
                    Swal.showValidationMessage('Vui lòng nhập tiêu đề sự kiện');
                    return false;
                }
                return {
                    title: title,
                    start: document.getElementById('editEventStartDate').value,
                    end: document.getElementById('editEventEndDate').value,
                    description: document.getElementById('editEventDescription').value,
                    type: document.getElementById('editEventType').value,
                    allDay: document.getElementById('editAllDayEvent').checked
                };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                updateEvent(event, result.value);
            }
        });
    }
    
    // Hàm xóa sự kiện
    function deleteEvent(event) {
        Swal.fire({
            title: 'Xác nhận xóa?',
            text: 'Bạn có chắc chắn muốn xóa sự kiện này không?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Xóa',
            cancelButtonText: 'Hủy bỏ',
            confirmButtonColor: '#e74a3b'
        }).then((result) => {
            if (result.isConfirmed) {
                event.remove();
                Swal.fire({
                    title: 'Đã xóa!',
                    text: 'Sự kiện đã được xóa thành công',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        });
    }
    
    // Hàm hỗ trợ lấy class cho sự kiện dựa trên loại
    function getEventClassName(type) {
        switch(type) {
            case 'meeting': return 'bg-primary';
            case 'deadline': return 'bg-danger';
            case 'reminder': return 'bg-warning';
            default: return 'bg-info';
        }
    }
    
    // Hàm hỗ trợ lấy tên loại sự kiện
    function getEventTypeName(type) {
        switch(type) {
            case 'meeting': return 'Cuộc họp';
            case 'deadline': return 'Hạn chót';
            case 'reminder': return 'Nhắc nhở';
            default: return 'Khác';
        }
    }
    
    // Hàm định dạng ngày tháng cho sự kiện
    function formatEventDate(start, end, allDay) {
        if (!start) return '';
        
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        
        if (allDay) {
            const startFormatted = start.toLocaleDateString('vi-VN', options);
            
            if (!end || start.toDateString() === end.toDateString()) {
                return startFormatted;
            } else {
                const endFormatted = end.toLocaleDateString('vi-VN', options);
                return `${startFormatted} đến ${endFormatted}`;
            }
        } else {
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            const startFormatted = `${start.toLocaleDateString('vi-VN', options)} ${start.toLocaleTimeString('vi-VN', timeOptions)}`;
            
            if (!end || start.toDateString() === end.toDateString()) {
                return startFormatted;
            } else {
                const endFormatted = `${end.toLocaleDateString('vi-VN', options)} ${end.toLocaleTimeString('vi-VN', timeOptions)}`;
                return `${startFormatted} đến ${endFormatted}`;
            }
        }
    }
    
    // Xử lý nút thêm sự kiện
    $('#addEventBtn').on('click', function() {
        const today = new Date().toISOString().slice(0, 10);
        showAddEventModal(today, today);
    });
    
    // Xử lý nút đồng bộ với Google Calendar
    $('#syncWithGoogle, #syncWithGoogleDropdown').on('click', function(e) {
        e.preventDefault();
        
        Swal.fire({
            title: 'Đồng bộ với Google Calendar',
            text: 'Bạn có muốn đồng bộ lịch của mình với Google Calendar không?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Đồng bộ',
            cancelButtonText: 'Hủy bỏ'
        }).then((result) => {
            if (result.isConfirmed) {
                // Hiển thị loading
                Swal.fire({
                    title: 'Đang kết nối...',
                    text: 'Vui lòng đợi trong giây lát',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                        
                        // Gọi API để bắt đầu quá trình xác thực OAuth
                        $.ajax({
                            url: '{% url "dashboard:google_calendar_auth" %}',
                            type: 'GET',
                            success: function(response) {
                                // Chuyển hướng đến trang xác thực của Google
                                window.location.href = response.auth_url;
                            },
                            error: function(error) {
                                Swal.fire({
                                    title: 'Lỗi kết nối!',
                                    text: 'Không thể kết nối với Google Calendar. Vui lòng thử lại sau.',
                                    icon: 'error'
                                });
                            }
                        });
                    }
                });
            }
        });
    });
    
    // Kiểm tra trạng thái đồng bộ
    function checkSyncStatus() {
        $.ajax({
            url: '{% url "dashboard:google_status" %}',
            type: 'GET',
            success: function(response) {
                if (response.is_synced) {
                    $('#syncStatus').html('<span class="badge badge-success">Đã đồng bộ</span>');
                    $('#lastSyncTime').text('Cập nhật lần cuối: ' + response.last_sync);
                } else {
                    $('#syncStatus').html('<span class="badge badge-warning">Chưa đồng bộ</span>');
                }
            }
        });
    }
    
    // Chạy khi trang load xong
    $(document).ready(function() {
        // Kiểm tra trạng thái đồng bộ
        checkSyncStatus();
        
        // Kiểm tra xem có thông báo đồng bộ thành công từ callback không
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('sync_success')) {
            Swal.fire({
                title: 'Đồng bộ thành công!',
                text: 'Lịch của bạn đã được đồng bộ với Google Calendar',
                icon: 'success'
            });
        }
    });
    
    // Xử lý nút in lịch
    $('#printCalendar, #printCalendarDropdown').on('click', function() {
        Swal.fire({
            title: 'In lịch',
            text: 'Bạn muốn in lịch theo định dạng nào?',
            icon: 'question',
            input: 'radio',
            inputOptions: {
                'month': 'Tháng hiện tại',
                'week': 'Tuần hiện tại',
                'agenda': 'Danh sách sự kiện'
            },
            inputValue: 'month',
            showCancelButton: true,
            confirmButtonText: 'In',
            cancelButtonText: 'Hủy bỏ'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Đang chuẩn bị in...',
                    text: 'Vui lòng đợi trong giây lát',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                        setTimeout(() => {
                            // Giả lập in ấn
                            window.print();
                            
                            setTimeout(() => {
                                Swal.fire({
                                    title: 'Đã gửi lệnh in!',
                                    icon: 'success'
                                });
                            }, 1000);
                        }, 1500);
                    }
                });
            }
        });
    });
    
    // Xử lý nút xuất báo cáo doanh thu
    $('#exportRevenueBtn').on('click', function() {
        Swal.fire({
            title: 'Xuất báo cáo doanh thu',
            text: 'Chọn định dạng file xuất',
            icon: 'question',
            input: 'radio',
            inputOptions: {
                'xlsx': 'Excel (.xlsx)',
                'pdf': 'PDF (.pdf)',
                'csv': 'CSV (.csv)'
            },
            inputValue: 'xlsx',
            showCancelButton: true,
            confirmButtonText: 'Xuất báo cáo',
            cancelButtonText: 'Hủy bỏ'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Đang xuất báo cáo...',
                    text: 'Vui lòng đợi trong giây lát',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                        setTimeout(() => {
                            Swal.fire({
                                title: 'Xuất báo cáo thành công!',
                                text: 'Báo cáo đã được tải xuống',
                                icon: 'success'
                            });
                        }, 2000);
                    }
                });
            }
        });
    });
    
    // Xử lý nút xuất báo cáo lợi nhuận
    $('#exportProfitBtn').on('click', function() {
        Swal.fire({
            title: 'Xuất báo cáo lợi nhuận',
            text: 'Chọn định dạng file xuất',
            icon: 'question',
            input: 'radio',
            inputOptions: {
                'xlsx': 'Excel (.xlsx)',
                'pdf': 'PDF (.pdf)',
                'csv': 'CSV (.csv)'
            },
            inputValue: 'xlsx',
            showCancelButton: true,
            confirmButtonText: 'Xuất báo cáo',
            cancelButtonText: 'Hủy bỏ'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Đang xuất báo cáo...',
                    text: 'Vui lòng đợi trong giây lát',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                        setTimeout(() => {
                            Swal.fire({
                                title: 'Xuất báo cáo thành công!',
                                text: 'Báo cáo đã được tải xuống',
                                icon: 'success'
                            });
                        }, 2000);
                    }
                });
            }
        });
    });
    
    // Khởi tạo biểu đồ lợi nhuận
    var profitCtx = document.getElementById('profitChart');
    if (profitCtx) {
        var profitChart = new Chart(profitCtx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                datasets: [
                    {
                        label: 'Doanh thu',
                        backgroundColor: 'rgba(78, 115, 223, 0.3)',
                        borderColor: 'rgba(78, 115, 223, 1)',
                        borderWidth: 1,
                        data: [5000000, 7500000, 8200000, 7800000, 9000000, 12000000, 11500000, 10800000, 13200000, 14500000, 15800000, 18000000]
                    },
                    {
                        label: 'Chi phí',
                        backgroundColor: 'rgba(231, 74, 59, 0.3)',
                        borderColor: 'rgba(231, 74, 59, 1)',
                        borderWidth: 1,
                        data: [3500000, 4200000, 4800000, 5000000, 5500000, 6300000, 6800000, 7000000, 7500000, 8200000, 9000000, 11000000]
                    },
                    {
                        label: 'Lợi nhuận',
                        backgroundColor: 'rgba(28, 200, 138, 0.3)',
                        borderColor: 'rgba(28, 200, 138, 1)',
                        borderWidth: 1,
                        data: [1500000, 3300000, 3400000, 2800000, 3500000, 5700000, 4700000, 3800000, 5700000, 6300000, 6800000, 7000000]
                    }
                ]
            },
            options: {
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 10,
                        right: 25,
                        top: 25,
                        bottom: 0
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('vi-VN', {
                                    style: 'currency',
                                    currency: 'VND',
                                    maximumFractionDigits: 0
                                }).format(value);
                            }
                        },
                        grid: {
                            borderDash: [2],
                            drawBorder: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('vi-VN', {
                                        style: 'currency', 
                                        currency: 'VND',
                                        maximumFractionDigits: 0
                                    }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}