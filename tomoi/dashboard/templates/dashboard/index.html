{% extends 'dashboard/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Tổng quan{% endblock %}

{% block extra_css %}
<link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<style>
    /* Card Styling nâng cấp */
    .dashboard-card {
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: none;
        overflow: hidden;
        background: linear-gradient(145deg, #ffffff, #f8f9fc);
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
    }
    
    /* Icons thống kê */
    .stats-icon {
        width: 55px;
        height: 55px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        font-size: 24px;
        margin-bottom: 1rem;
        color: white;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        transition: all 0.4s ease;
    }
    
    .icon-primary { background-color: #df2626; }
    .icon-success { background-color: #1cc88a; }
    .icon-info { background-color: #36b9cc; }
    .icon-warning { background-color: #f6c23e; }
    
    /* Cải thiện giao diện lịch */
    .fc {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 1rem;
    }
    
    /* View tháng */
    .fc .fc-daygrid-day {
        min-height: 120px !important;
    }
    
    .fc .fc-daygrid-day-frame {
        padding: 8px;
    }
    
    .fc-event-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
    }
    
    /* View tuần và ngày */
    .fc .fc-timegrid-slot {
        height: 50px !important;
        border-bottom: 1px solid #eee;
    }
    
    .fc .fc-timegrid-event {
        border-radius: 4px;
        padding: 2px 4px;
        margin: 1px;
    }
    
    .fc .fc-timegrid-event .fc-event-main {
        padding: 4px;
    }
    
    .fc .fc-timegrid-event .fc-event-time {
        font-size: 0.85em;
        font-weight: bold;
    }
    
    .fc .fc-timegrid-event .fc-event-title {
        font-size: 0.9em;
    }
    
    /* Modal sự kiện */
    .event-details-modal {
        padding: 0;
    }
    
    .event-details-header {
        padding: 1rem;
        border-bottom: 1px solid #eee;
    }
    
    .event-details-body {
        padding: 1rem;
    }
    
    .event-time-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        background: #f8f9fa;
        margin-top: 0.5rem;
    }
    
    /* Màu sắc cho các loại sự kiện */
    .event-meeting { background-color: #4e73df !important; }
    .event-deadline { background-color: #e74a3b !important; }
    .event-reminder { background-color: #f6c23e !important; }
    .event-other { background-color: #1cc88a !important; }
    
    /* Đồng nhất các chiều cao */
    .equal-height-row {
        display: flex;
        flex-wrap: wrap;
    }
    
    .equal-height-row > div {
        display: flex;
        flex-direction: column;
    }
    
    .equal-height-row .card {
        flex: 1;
        margin-bottom: 20px;
    }
    
    /* Cải thiện display cho các chart */
    .chart-card, .chart-area, .chart-pie, .chart-container {
        height: 300px;
        position: relative;
        width: 100%;
        margin-bottom: 20px;
    }
    
    .chart-container.miniature {
        height: 200px;
    }
    
    /* Cải thiện dropdown menu */
    .card-header {
        position: relative;
        z-index: 10;
        background: linear-gradient(45deg, #f8f9fc, #ffffff);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1.25rem 1.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .dropdown-menu {
        position: absolute;
        z-index: 1000;
    }
    
    .dropdown-menu-right {
        right: 0;
        left: auto;
    }
    
    /* FullCalendar styling (đã gộp và tối ưu) */
    .fc-header-toolbar {
        padding: 1rem;
        background: linear-gradient(to right, #f8f9fc, #eaecf4);
        border-bottom: 1px solid #e3e6f0;
        margin-bottom: 1.5em !important;
    }
    
    .fc-button-primary:not(:disabled):active,
    .fc-button-primary:not(:disabled).fc-button-active {
        background-color: #b51818 !important;
        border-color: #b51818 !important;
    }
    
    .fc-event:hover {
        transform: translateY(-3px) !important;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1) !important;
        z-index: 10 !important;
    }
    
    .fc-daygrid-event-dot {
        border-color: #df2626 !important;
    }
    
    .fc-day-today {
        background-color: rgba(223, 38, 38, 0.05) !important;
    }
    
    .fc-highlight {
        background-color: rgba(223, 38, 38, 0.2) !important;
        border: 1px dashed #df2626 !important;
    }
    
    .fc-daygrid-day {
        cursor: pointer;
    }
    
    .fc-daygrid-day-number {
        font-weight: 600;
        color: #5a5c69;
    }
    
    .fc-daygrid-day-top {
        justify-content: center;
    }
    
    .fc-col-header-cell-cushion {
        font-weight: 700;
        color: #4e73df;
    }
    
    /* Nút thêm sự kiện cố định */
    .btn-add-event {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        background: linear-gradient(45deg, #4e73df, #2653d4);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(78, 115, 223, 0.4);
        cursor: pointer;
        border: none;
        z-index: 1000;
        transition: all 0.3s ease;
    }
    
    .btn-add-event:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 6px 30px rgba(78, 115, 223, 0.6);
    }
    
    .btn-add-event i {
        font-size: 24px;
    }
    
    /* Card styling (đã gộp các thuộc tính trùng lặp) */
    .card {
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
        border: none;
        overflow: hidden;
        position: relative;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    /* Button styling */
    .btn {
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-weight: 600;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
    }
    
    .btn-primary {
        background-color: #df2626;
        border-color: #df2626;
    }
    
    .btn-primary:hover {
        background-color: #c51d1d;
        border-color: #c51d1d;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(223, 38, 38, 0.25);
    }
    
    .btn-secondary {
        background-color: #858796;
        border-color: #858796;
    }
    
    .btn-secondary:hover {
        background-color: #717384;
        border-color: #717384;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(133, 135, 150, 0.25);
    }
    
    /* Nút đồng bộ Google Calendar */
    .btn-sync-google {
        background: linear-gradient(135deg, #4285F4, #34A853);
        color: #fff;
        border: none;
        position: relative;
        overflow: hidden;
        z-index: 1;
        transition: all 0.3s;
        box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3);
    }
    
    .btn-sync-google:before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #34A853, #FBBC05, #EA4335);
        transition: 0.5s;
        z-index: -1;
    }
    
    .btn-sync-google:hover:before {
        left: 0;
    }
    
    .btn-sync-google:hover {
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(66, 133, 244, 0.4);
    }
    
    .btn-sync-google:focus, 
    .btn-sync-google:active {
        outline: none;
        box-shadow: 0 0 0 0.2rem rgba(66, 133, 244, 0.5);
    }
    
    .btn-sync-google i {
        margin-right: 8px;
    }
    
    /* Badge styling */
    .badge {
        padding: 0.5em 0.75em;
        font-weight: 600;
        border-radius: 30px;
    }
    
    .badge-success { background-color: #1cc88a; color: white; }
    .badge-warning { background-color: #f6c23e; color: white; }
    .badge-danger { background-color: #e74a3b; color: white; }
    .badge-primary { background-color: #4e73df; color: white; }
    .badge-info { background-color: #36b9cc; color: white; }
    
    /* Tooltip cải tiến */
    .custom-tooltip {
        position: relative;
        display: inline-block;
    }
    
    .custom-tooltip .tooltip-text {
        visibility: hidden;
        width: 200px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .custom-tooltip .tooltip-text::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #333 transparent transparent transparent;
    }
    
    .custom-tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
    }
    
    /* Table styling */
    .table {
        border-radius: 10px;
        overflow: hidden;
    }
    
    .table thead th {
        background-color: #f8f9fc;
        border-top: none;
        border-bottom: 1px solid #e3e6f0;
        font-weight: 700;
        color: #4e73df;
    }
    
    .table-hover tbody tr {
        transition: all 0.2s ease;
    }
    
    .table-hover tbody tr:hover {
        background-color: rgba(78, 115, 223, 0.05);
        transform: translateX(5px);
    }
    
    /* Method select styling */
    .method-select {
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 8px;
    }
    
    .method-select:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .method-select.selected {
        background-color: rgba(223, 38, 38, 0.1);
        border-color: #df2626 !important;
        transform: translateY(-3px);
    }
    
    /* Toast container */
    #toastContainer {
        z-index: 9999;
        position: fixed;
        top: 20px;
        right: 20px;
    }
    
    .toast {
        opacity: 0;
        animation: fadeIn 0.3s ease forwards;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Tab styling */
    .dashboard-tabs .nav-link {
        color: #5a5c69;
        border: none;
        padding: 10px 20px;
        border-radius: 5px 5px 0 0;
        font-weight: 600;
    }
    
    .dashboard-tabs .nav-link.active {
        color: #df2626;
        background-color: #fff;
        border-bottom: 3px solid #df2626;
    }
    
    .tab-content > .tab-pane {
        display: none;
    }
    
    .tab-content > .active {
        display: block;
    }
    
    /* Modal styling */
    .modal-header {
        background-color: #f8f9fc;
        border-bottom: 1px solid #e3e6f0;
    }
    
    .modal-footer {
        background-color: #f8f9fc;
        border-top: 1px solid #e3e6f0;
    }
    
    /* Order status styling */
    .order-status {
        color: #fff;
        font-weight: 600;
        padding: 5px 10px;
        border-radius: 5px;
        display: inline-block;
        font-size: 0.85rem;
    }
    
    .status-completed { background-color: #1cc88a; }
    .status-shipping { background-color: #36b9cc; }
    .status-processing { background-color: #4e73df; }
    .status-cancelled { background-color: #e74a3b; }
    .status-pending { background-color: #f6c23e; }
    
    /* Premium subscription table */
    .premium-table tr {
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .premium-table tr:hover {
        background-color: rgba(0,0,0,0.02);
    }
    
    /* Media queries */
    @media (max-width: 1200px) {
        .dashboard-col-calendar, .dashboard-col-charts {
            flex: 0 0 100%;
            max-width: 100%;
        }
    }

    /* CSS cho tour hướng dẫn */
    .tutorial-highlight {
        position: relative;
        z-index: 9998;
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
        border-radius: 5px;
        animation: tutorialPulse 1.5s infinite;
    }

    @keyframes tutorialPulse {
        0% { box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 0 0 rgba(223, 38, 38, 0.7); }
        70% { box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 0 10px rgba(223, 38, 38, 0); }
        100% { box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 0 0 rgba(223, 38, 38, 0); }
    }

    .tutorial-swal-container {
        z-index: 9999;
    }

    .tutorial-popup-top {
        margin-top: 150px !important;
    }

    .tutorial-popup-bottom {
        margin-top: -150px !important;
    }

    .tutorial-popup-left {
        margin-left: 150px !important;
    }

    .tutorial-popup-right {
        margin-left: -150px !important;
    }

    /* CSS cho toast notification */
    #toastContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }

    .toast {
        min-width: 250px;
        background-color: white;
        box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        opacity: 0;
        border-radius: 0.5rem;
        border-left: 4px solid #df2626;
        animation: toastFadeIn 0.3s ease forwards;
    }

    @keyframes toastFadeIn {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* CSS cho chế độ in */
    @media print {
        .no-print, .no-print * {
            display: none !important;
        }
        
        .print-only {
            display: block !important;
        }
        
        body {
            background-color: white;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .container-fluid {
            padding: 0;
        }
        
        .card {
            box-shadow: none !important;
            border: 1px solid #e3e6f0 !important;
        }
    }

    /* Styles cho hover effects */
    .hover-effect {
        transition: all 0.3s ease;
    }

    .hover-effect:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
        background: #d4d4d4;
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #df2626;
    }

    /* Loading indicator */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #df2626;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .stats-icon {
            width: 45px;
            height: 45px;
            font-size: 20px;
        }
        
        .card-header {
            padding: 0.75rem 1rem;
        }
        
        .card-body {
            padding: 1rem;
        }
        
        .calendar-container {
            height: 450px !important;
        }
        
        #calendar {
            height: 450px !important;
        }
        
        .fc-toolbar {
            flex-direction: column;
        }
        
        .fc-toolbar-chunk {
            margin-bottom: 0.5rem;
        }
    }

    /* Modal chi tiết đơn hàng */
    .order-details-popup {
        padding: 1.5rem;
        border-radius: 15px;
    }

    .order-title {
        color: #df2626;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        text-align: left;
        border-bottom: 2px solid #df2626;
        padding-bottom: 0.5rem;
    }

    .order-section {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 1.5rem;
        padding: 1.25rem;
        text-align: left;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        color: #df2626;
    }

    .section-header i {
        margin-right: 0.5rem;
        font-size: 1.2rem;
    }

    .section-header h6 {
        margin: 0;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .info-row {
        display: grid;
        grid-template-columns: 150px 1fr;
        margin-bottom: 0.75rem;
        align-items: center;
    }

    .info-label {
        color: #666;
        font-weight: 500;
        display: flex;
        align-items: center;
    }

    .info-label i {
        width: 20px;
        color: #df2626;
        margin-right: 0.5rem;
    }

    .info-value {
        color: #333;
    }

    .table {
        margin-bottom: 0;
        width: 100%;
    }

    .table thead th {
        background-color: #f8f9fc;
        border-top: none;
        font-weight: 600;
        white-space: nowrap;
    }

    .table td, .table th {
        padding: 0.75rem;
        vertical-align: middle;
    }

    .table td:first-child {
        text-align: left;
    }

    .table td.text-center {
        text-align: center !important;
    }

    .table td.text-right, 
    .table th.text-right {
        text-align: right !important;
    }

    .badge {
        padding: 0.5em 1em;
        font-size: 0.85em;
    }

    /* Sửa lại style cho SweetAlert2 */
    .swal2-popup {
        text-align: left !important;
    }

    .swal2-html-container {
        text-align: left !important;
    }

    /* Form sự kiện */
    .event-modal .swal2-html-container {
        text-align: left;
    }

    .event-modal .form-label.required::after {
        content: '*';
        color: #df2626;
        margin-left: 4px;
    }

    .event-modal .form-control {
        margin-bottom: 0.5rem;
    }

    /* Tooltip sự kiện */
    .event-tooltip {
        padding: 8px;
    }

    .event-tooltip .event-title {
        font-weight: bold;
        margin-bottom: 4px;
    }

    .event-tooltip .event-time {
        font-size: 0.9em;
        color: #666;
    }

    .event-tooltip .event-desc {
        margin-top: 4px;
        font-size: 0.9em;
    }

    /* Modal sự kiện trong ngày */
    .day-events {
        max-height: 400px;
        overflow-y: auto;
        padding: 10px;
    }

    .event-block {
        margin-bottom: 15px;
        padding: 12px;
        border-radius: 8px;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-left: 4px solid;
    }

    .event-block.event-meeting {
        border-color: #4e73df;
    }

    .event-block.event-deadline {
        border-color: #e74a3b;
    }

    .event-block.event-reminder {
        border-color: #f6c23e;
    }

    .event-block .event-time {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 5px;
    }

    .event-block .event-title {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .event-block .event-description {
        font-size: 0.9em;
        color: #666;
    }

    /* Nút thêm sự kiện */
    .btn-add-event {
        background-color: #df2626;
        border-color: #df2626;
    }

    .btn-add-event:hover {
        background-color: #c51f1f;
        border-color: #c51f1f;
    }

    /* Cải thiện hiển thị của các card thống kê */
    .card-stats {
        height: 100%;
        border-left: 4px solid transparent;
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    /* Màu sắc cho từng loại card */
    .card-stats.card-primary {
        border-left-color: #4e73df;
    }
    
    .card-stats.card-success {
        border-left-color: #1cc88a;
    }
    
    .card-stats.card-info {
        border-left-color: #36b9cc;
    }
    
    .card-stats.card-warning {
        border-left-color: #f6c23e;
    }
    
    /* Cải thiện hiển thị nội dung trong card */
    .card-stats .card-body {
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
    }
    
    /* Tiêu đề card */
    .card-stats .card-title {
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        color: #858796;
        margin-bottom: 0.75rem;
        letter-spacing: 0.05rem;
    }
    
    /* Giá trị chính */
    .card-stats .card-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #5a5c69;
        margin-bottom: 0.5rem;
        line-height: 1.2;
    }
    
    /* Phần so sánh */
    .card-stats .card-comparison {
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        margin-top: auto;
    }
    
    /* Icon tăng/giảm */
    .card-stats .card-comparison i {
        margin-right: 0.25rem;
        font-size: 0.9rem;
    }
    
    /* Màu sắc cho tăng/giảm */
    .card-stats .text-success {
        color: #1cc88a !important;
    }
    
    .card-stats .text-danger {
        color: #e74a3b !important;
    }
    
    /* Icon cho từng loại card */
    .card-stats .card-icon {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 2rem;
        opacity: 0.3;
        color: #4e73df;
    }
    
    /* Hiệu ứng hover */
    .card-stats:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    /* Đảm bảo các card có chiều cao bằng nhau */
    .row-stats {
        display: flex;
        flex-wrap: wrap;
    }
    
    .row-stats > div {
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Thêm CSRF token -->
{% csrf_token %}
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Tổng quan</h1>
        <div class="d-flex align-items-center">
            <!-- Thay thế 2 nút trùng lặp bằng một nút đồng bộ Google Calendar -->
            <button id="syncGoogleBtn" class="btn btn-sync-google mr-2">
                <i class="fab fa-google"></i> Đồng bộ với Google
            </button>
            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="exportCalendarBtn">
                <i class="fas fa-download fa-sm text-white-50 mr-1"></i> Xuất báo cáo
            </a>
        </div>
    </div>

    <!-- Thống kê tổng quan -->
    <div class="row mb-4">
        <!-- Tổng doanh thu -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Doanh thu (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">50.000.000đ</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>12% so với tháng trước</span>
                            </div>
                            </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-primary">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tổng đơn hàng -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Đơn hàng (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">215</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>8% so với tháng trước</span>
                            </div>
                            </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-success">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Người dùng mới -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Người dùng mới (tháng)</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">82</div>
                            <div class="text-xs text-success mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>5% so với tháng trước</span>
                            </div>
                            </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-info">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tài khoản Premium -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card dashboard-card shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">
                                Tài khoản Premium</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">45</div>
                            <div class="text-xs text-danger mt-2">
                                <i class="fas fa-clock mr-1"></i>
                                <span>8 gói sắp hết hạn</span>
                            </div>
                            </div>
                        <div class="col-auto">
                            <div class="stats-icon icon-warning">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bố cục mới với chiều cao đồng đều -->
    <div class="row equal-height-row">
        <!-- Khối lịch sự kiện -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow h-100">
                <!-- Thêm thông tin trạng thái đồng bộ vào header của khối lịch -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        Lịch sự kiện và nhắc nhở 
                        <span class="ml-2" id="syncStatus"></span>
                    </h6>
                    <div>
                        <small id="lastSyncTime" class="text-muted mr-2"></small>
                    <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="calendarDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="calendarDropdown">
                                <div class="dropdown-header">Tùy chọn:</div>
                                <a class="dropdown-item" href="#" id="syncWithGoogleDropdown">
                                    <i class="fas fa-sync fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Đồng bộ với Google
                                </a>
                                <a class="dropdown-item" href="#" id="printCalendarDropdown">
                                    <i class="fas fa-print fa-sm fa-fw mr-2 text-gray-400"></i>
                                    In lịch
                                </a>
                        </div>
                    </div>
                </div>
                    </div>
                <div class="card-body calendar-container p-0">
                    <div id="calendar"></div>
                    </div>
            </div>
        </div>
        
        <!-- Khối biểu đồ bên phải -->
        <div class="col-xl-6 col-lg-6">
            <!-- Biểu đồ doanh thu -->
            <div class="card shadow chart-card">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Doanh thu</h6>
                    <div class="dropdown">
                        <button class="btn btn-link text-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <span class="filter-text">Tháng này</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right shadow">
                            <a class="dropdown-item chart-filter" href="#" data-chart="revenue" data-range="day">Hôm nay</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="revenue" data-range="week">Tuần này</a>
                            <a class="dropdown-item chart-filter active" href="#" data-chart="revenue" data-range="month">Tháng này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="revenue" data-range="quarter">Quý này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="revenue" data-range="year">Năm nay</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area card-chart-container">
                        <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>

            <!-- Biểu đồ lợi nhuận -->
            <div class="card shadow chart-card">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Lợi nhuận</h6>
                    <div class="dropdown">
                        <button class="btn btn-link text-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <span class="filter-text">Tháng này</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right shadow">
                            <a class="dropdown-item chart-filter" href="#" data-chart="profit" data-range="day">Hôm nay</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="profit" data-range="week">Tuần này</a>
                            <a class="dropdown-item chart-filter active" href="#" data-chart="profit" data-range="month">Tháng này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="profit" data-range="quarter">Quý này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="profit" data-range="year">Năm nay</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area card-chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                        </div>
                        </div>
        </div>
    </div>

    <!-- Thêm hàng mới với đơn hàng gần đây và trạng thái đơn hàng -->
    <div class="row equal-height-row">
        <!-- Đơn hàng gần đây -->
        <div class="col-xl-7 col-lg-7">
            <div class="card shadow h-100">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Đơn hàng gần đây</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="ordersDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="ordersDropdown">
                            <div class="dropdown-header">Tùy chọn:</div>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-shopping-cart fa-sm fa-fw mr-2 text-gray-400"></i>
                                Xem tất cả đơn hàng
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Mã đơn</th>
                                    <th>Khách hàng</th>
                                    <th>Ngày đặt</th>
                                    <th>Tổng tiền</th>
                                    <th>Trạng thái</th>
                                    <th>Chi tiết</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#ORD-4872</td>
                                    <td>Nguyễn Văn A</td>
                                    <td>20/07/2023</td>
                                    <td>1.500.000đ</td>
                                    <td><span class="badge badge-success">Hoàn thành</span></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary btn-view-order" data-order-id="4872">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#ORD-4871</td>
                                    <td>Trần Thị B</td>
                                    <td>19/07/2023</td>
                                    <td>2.700.000đ</td>
                                    <td><span class="badge badge-info">Đang giao</span></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary btn-view-order" data-order-id="4871">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#ORD-4870</td>
                                    <td>Lê Văn C</td>
                                    <td>19/07/2023</td>
                                    <td>850.000đ</td>
                                    <td><span class="badge badge-primary">Đang xử lý</span></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary btn-view-order" data-order-id="4870">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#ORD-4869</td>
                                    <td>Phạm Thị D</td>
                                    <td>18/07/2023</td>
                                    <td>3.200.000đ</td>
                                    <td><span class="badge badge-danger">Đã hủy</span></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary btn-view-order" data-order-id="4869">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#ORD-4868</td>
                                    <td>Hoàng Văn E</td>
                                    <td>17/07/2023</td>
                                    <td>1.200.000đ</td>
                                    <td><span class="badge badge-success">Hoàn thành</span></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary btn-view-order" data-order-id="4868">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trạng thái đơn hàng -->
        <div class="col-xl-5 col-lg-5">
            <div class="card shadow h-100">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Trạng thái đơn hàng</h6>
                    <div class="dropdown">
                        <button class="btn btn-link text-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <span class="filter-text">Tháng này</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right shadow">
                            <a class="dropdown-item chart-filter" href="#" data-chart="order" data-range="day">Hôm nay</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="order" data-range="week">Tuần này</a>
                            <a class="dropdown-item chart-filter active" href="#" data-chart="order" data-range="month">Tháng này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="order" data-range="quarter">Quý này</a>
                            <a class="dropdown-item chart-filter" href="#" data-chart="order" data-range="year">Năm nay</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-pie card-chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nút thêm sự kiện cố định -->
    <button class="btn-add-event" id="addEventBtn" title="Thêm sự kiện mới">
        <i class="fas fa-plus"></i>
    </button>
</div>

<!-- Tài khoản Premium -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <ul class="nav nav-tabs" id="subscriptionTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="today-tab" data-toggle="tab" href="#today" role="tab" aria-controls="today" aria-selected="true">
                    Hôm nay <span class="badge badge-pill badge-primary ml-1">{{ today_count|default:'0' }}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="upcoming-tab" data-toggle="tab" href="#upcoming" role="tab" aria-controls="upcoming" aria-selected="false">
                    Sắp tới <span class="badge badge-pill badge-warning ml-1">{{ upcoming_count|default:'0' }}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="expired-tab" data-toggle="tab" href="#expired" role="tab" aria-controls="expired" aria-selected="false">
                    Đã hết hạn <span class="badge badge-pill badge-danger ml-1">{{ expired_count|default:'0' }}</span>
                </a>
            </li>
        </ul>
                </div>
                <div class="card-body">
        <div class="tab-content" id="subscriptionTabsContent">
            <div class="tab-pane fade show active" id="today" role="tabpanel" aria-labelledby="today-tab">
                    <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="todayTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                    <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                                </tr>
                            </thead>
                        <tbody id="todayTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                        </tbody>
                    </table>
                                            </div>
                                        </div>
            
            <div class="tab-pane fade" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
                <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="upcomingTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                <th>Còn lại</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                                </tr>
                        </thead>
                        <tbody id="upcomingTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                            </tbody>
                        </table>
        </div>
    </div>

            <div class="tab-pane fade" id="expired" role="tabpanel" aria-labelledby="expired-tab">
                    <div class="table-responsive">
                    <table class="table table-bordered premium-table" id="expiredTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                <th>Thời hạn</th>
                                <th>Người dùng</th>
                                <th>Ngày hết hạn</th>
                                <th>Quá hạn</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                                <th>Chi tiết</th>
                                </tr>
                            </thead>
                        <tbody id="expiredTableBody">
                            <!-- Dữ liệu sẽ được thêm từ API -->
                            </tbody>
                        </table>
                                            </div>
                                            </div>
                                        </div>
                                        </div>
                    </div>

<!-- Cập nhật modal thêm sự kiện -->
<div class="modal fade" id="addEventModal" tabindex="-1" role="dialog" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEventModalLabel">Thêm sự kiện mới</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addEventForm">
                    <div class="form-group">
                        <label for="eventTitle">Tiêu đề sự kiện <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="eventStartDate">Ngày bắt đầu <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="eventStartDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="eventEndDate">Ngày kết thúc</label>
                                <input type="date" class="form-control" id="eventEndDate">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="eventType">Loại sự kiện</label>
                        <select class="form-control" id="eventType">
                            <option value="reminder">Nhắc nhở gia hạn Premium</option>
                            <option value="meeting">Cuộc họp</option>
                            <option value="deadline">Thời hạn</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">Mô tả</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Người tham gia</label>
                        <select class="form-control select2" id="eventParticipants" multiple>
                            <option value="user1">user1@example.com</option>
                            <option value="user2">user2@example.com</option>
                            <option value="user3">user3@example.com</option>
                            <option value="user4">user4@example.com</option>
                        </select>
                        <small class="form-text text-muted">Chọn người dùng để thông báo về sự kiện này</small>
                    </div>
                    <div class="form-group">
                        <label>Phương thức nhắc nhở</label>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="notifyEmail" checked>
                            <label class="custom-control-label" for="notifyEmail">Email</label>
                        </div>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="notifySMS">
                            <label class="custom-control-label" for="notifySMS">SMS</label>
                        </div>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="notifyZalo">
                            <label class="custom-control-label" for="notifyZalo">Zalo</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger mr-auto" id="deleteEventBtn" style="display: none;">
                    <i class="fas fa-trash-alt"></i> Xóa sự kiện
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="submit" form="addEventForm" class="btn btn-primary" id="saveEventBtn">Lưu sự kiện</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Chi tiết Sự kiện -->
<div class="modal fade" id="eventDetailModal" tabindex="-1" role="dialog" aria-labelledby="eventDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventDetailModalLabel">Chi tiết sự kiện</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                        </div>
            <div class="modal-body" id="eventDetailContent">
                <!-- Nội dung chi tiết sự kiện sẽ được hiển thị ở đây -->
                    </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-danger d-none" id="deleteEventBtn">Xóa sự kiện</button>
                </div>
                                </div>
                                </div>
                            </div>
                        
<!-- Modal Chi tiết đơn hàng -->
<div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailModalLabel">Chi tiết đơn hàng</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
      <div class="modal-body" id="orderDetailContent">
        <!-- Nội dung sẽ được điền bởi JavaScript -->
                                </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary">Xem chi tiết</button>
                            </div>
    </div>
                            </div>
                        </div>
                        
<!-- Modal Nhắc nhở Gia hạn -->
<div class="modal fade" id="reminderModal" tabindex="-1" role="dialog" aria-labelledby="reminderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reminderModalLabel">Gửi nhắc nhở gia hạn</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                                </div>
            <div class="modal-body">
                <h6 class="font-weight-bold mb-3">Chọn phương thức gửi thông báo</h6>
                <input type="hidden" id="subscriptionId" value="">
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="email">
                            <i class="fas fa-envelope fa-2x mb-2 text-primary"></i>
                            <h6>Email</h6>
                            <small>Gửi email nhắc gia hạn</small>
                                </div>
                            </div>
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="sms">
                            <i class="fas fa-sms fa-2x mb-2 text-success"></i>
                            <h6>SMS</h6>
                            <small>Gửi SMS tới điện thoại</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="method-select text-center p-3 border rounded mb-3" data-method="zalo">
                            <i class="fab fa-facebook-messenger fa-2x mb-2 text-info"></i>
                            <h6>Zalo</h6>
                            <small>Gửi tin nhắn qua Zalo</small>
                        </div>
                            </div>
                        </div>
                        
                <div class="form-group mt-4">
                    <label for="reminderMessage">Nội dung nhắc nhở:</label>
                    <textarea class="form-control" id="reminderMessage" rows="4" placeholder="Nhập nội dung tin nhắn nhắc nhở gia hạn...">Thông báo: Tài khoản Premium của bạn sắp hết hạn. Vui lòng gia hạn để tiếp tục sử dụng dịch vụ.</textarea>
                                </div>
                                </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="sendReminderBtn">Gửi nhắc nhở</button>
                            </div>
                            </div>
                            </div>
                        </div>
                        
<!-- Toast Container -->
<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

<!-- Modal Khảo sát lý do không gia hạn -->
<div class="modal fade" id="surveyModal" tabindex="-1" role="dialog" aria-labelledby="surveyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="surveyModalLabel">Khảo sát lý do không gia hạn</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                                </div>
            <div class="modal-body">
                <p class="mb-4">Quý khách vui lòng cho biết lý do không tiếp tục gia hạn dịch vụ Premium:</p>
                
                <form id="surveyForm">
                    <input type="hidden" id="surveySubscriptionId" value="">
                    
                    <div class="form-group">
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason1" value="no_budget">
                            <label class="custom-control-label" for="reason1">Tôi không có đủ chi phí để gia hạn</label>
                            <div class="mt-2 ml-4 small text-primary d-none" id="tcoinInfo">
                                <i class="fas fa-info-circle mr-1"></i> Có thể bạn chưa biết: TomOi.vn hỗ trợ bạn điểm danh hàng ngày và làm nhiệm vụ để nhận TCoin, giúp bạn có thể mua tài khoản Premium với giá 0 đồng.
                                <a href="/accounts/tcoin/" class="font-weight-bold">Tìm hiểu ngay</a>
                                </div>
                            </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason2" value="not_satisfied">
                            <label class="custom-control-label" for="reason2">Tôi cảm thấy chưa hài lòng về dịch vụ</label>
                            </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason3" value="not_worth">
                            <label class="custom-control-label" for="reason3">Tôi cảm thấy sản phẩm không xứng với số tiền bỏ ra</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason4" value="bugs">
                            <label class="custom-control-label" for="reason4">Sản phẩm hay bị lỗi</label>
                                </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason5" value="slow_warranty">
                            <label class="custom-control-label" for="reason5">Thời gian bảo hành lâu</label>
                                </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason6" value="better_price">
                            <label class="custom-control-label" for="reason6">Tôi tìm được nơi khác có mức giá rẻ hơn</label>
                            </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason7" value="dont_like_sharing">
                            <label class="custom-control-label" for="reason7">Tôi không thích sản phẩm dùng chung</label>
                            </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason8" value="security_concerns">
                            <label class="custom-control-label" for="reason8">Tôi cảm thấy không yên tâm về bảo mật</label>
                        </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason9" value="rarely_use">
                            <label class="custom-control-label" for="reason9">Tôi ít sử dụng sản phẩm nên không cần thiết nữa</label>
                    </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input survey-reason" id="reason10" value="want_better">
                            <label class="custom-control-label" for="reason10">Tôi muốn đổi sang sản phẩm khác tốt hơn</label>
                </div>
                        
                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input" id="reasonOther">
                            <label class="custom-control-label" for="reasonOther">Khác</label>
                            <div class="mt-2 ml-4 d-none" id="otherReasonContainer">
                                <textarea class="form-control" id="otherReason" rows="2" placeholder="Vui lòng cho biết lý do cụ thể..."></textarea>
                    </div>
                </div>
            </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="submitSurveyBtn">Gửi khảo sát</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal thông báo hủy gia hạn thành công -->
<div class="modal fade" id="cancelSuccessModal" tabindex="-1" role="dialog" aria-labelledby="cancelSuccessModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="cancelSuccessModalLabel">Hủy gia hạn thành công</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 64px;"></i>
                </div>
                <p class="text-center mb-4">Bạn đã hủy gia hạn dịch vụ Premium thành công.</p>
                <p class="text-center">Bạn đã nhận được <strong>+50 TCoin</strong> vào tài khoản. Cảm ơn bạn đã tham gia khảo sát!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal xuất báo cáo -->
<div class="modal fade" id="exportReportModal" tabindex="-1" role="dialog" aria-labelledby="exportReportModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportReportModalLabel">Xuất báo cáo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="exportReportForm">
                    <div class="form-group">
                        <label for="reportType">Loại báo cáo</label>
                        <select class="form-control" id="reportType">
                            <option value="revenue">Doanh thu</option>
                            <option value="profit">Lợi nhuận</option>
                            <option value="orders">Đơn hàng</option>
                            <option value="users">Người dùng</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="reportStartDate">Từ ngày</label>
                                <input type="date" class="form-control" id="reportStartDate">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="reportEndDate">Đến ngày</label>
                                <input type="date" class="form-control" id="reportEndDate">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reportFormat">Định dạng</label>
                        <select class="form-control" id="reportFormat">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="generateReportBtn">Tạo báo cáo</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Thêm các thư viện cần thiết -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/locales/vi.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Thêm file JavaScript chính -->
<script src="{% static 'dashboard/js/index.js' %}"></script>

<script>
// Thêm vào phần JavaScript hiện có
$(document).ready(function() {
    // Biến để lưu trữ ID sự kiện đang được cập nhật
    let currentEventId = null;
    
    // Khi mở modal thêm sự kiện mới
    $('#addEventModal').on('show.bs.modal', function(event) {
        const button = $(event.relatedTarget);
        const mode = button.data('mode'); // 'add' hoặc 'edit'
        const modal = $(this);
        
        // Reset form
        $('#addEventForm')[0].reset();
        
        if (mode === 'edit') {
            // Đang ở chế độ cập nhật
            currentEventId = button.data('event-id');
            modal.find('.modal-title').text('Cập nhật sự kiện');
            
            // Hiển thị nút xóa
            $('#deleteEventBtn').show();
            
            // Lấy dữ liệu sự kiện và điền vào form
            // (Giả sử dữ liệu được lấy từ API hoặc từ dữ liệu đã có)
            // Ví dụ: fillEventData(currentEventId);
        } else {
            // Đang ở chế độ thêm mới
            currentEventId = null;
            modal.find('.modal-title').text('Thêm sự kiện mới');
            
            // Ẩn nút xóa
            $('#deleteEventBtn').hide();
        }
    });
    
    // Xử lý sự kiện click vào nút xóa
    $('#deleteEventBtn').on('click', function() {
        if (!currentEventId) return;
        
        // Hiển thị hộp thoại xác nhận
        Swal.fire({
            title: 'Xác nhận xóa',
            text: 'Bạn có chắc chắn muốn xóa sự kiện này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Xóa',
            cancelButtonText: 'Hủy'
        }).then((result) => {
            if (result.isConfirmed) {
                // Gọi API để xóa sự kiện
                deleteEvent(currentEventId);
            }
        });
    });
    
    // Hàm xóa sự kiện
    function deleteEvent(eventId) {
        // Gọi API để xóa sự kiện
        // Ví dụ:
        /*
        $.ajax({
            url: `/api/events/${eventId}/`,
            method: 'DELETE',
            success: function(response) {
                // Đóng modal
                $('#addEventModal').modal('hide');
                
                // Hiển thị thông báo thành công
                Swal.fire(
                    'Đã xóa!',
                    'Sự kiện đã được xóa thành công.',
                    'success'
                );
                
                // Cập nhật lại lịch
                calendar.refetchEvents();
            },
            error: function(error) {
                Swal.fire(
                    'Lỗi!',
                    'Không thể xóa sự kiện. Vui lòng thử lại sau.',
                    'error'
                );
            }
        });
        */
        
        // Mã giả để demo
        console.log(`Đã xóa sự kiện có ID: ${eventId}`);
        $('#addEventModal').modal('hide');
        
        // Hiển thị thông báo thành công
        Swal.fire(
            'Đã xóa!',
            'Sự kiện đã được xóa thành công.',
            'success'
        );
        
        // Cập nhật lại lịch (nếu có)
        if (typeof calendar !== 'undefined') {
            calendar.refetchEvents();
        }
    }
});
</script>
{% endblock %}

