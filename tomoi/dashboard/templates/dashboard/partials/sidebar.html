<!-- Sidebar -->
<ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

    <!-- Sidebar - Brand -->
    <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'dashboard:index' %}">
        <div class="sidebar-brand-icon rotate-n-15">
            <i class="fas fa-laugh-wink"></i>
        </div>
        <div class="sidebar-brand-text mx-3">TomOi <sup>Admin</sup></div>
    </a>

    <!-- Divider -->
    <hr class="sidebar-divider my-0">

    <!-- Nav Item - Dashboard -->
    <li class="nav-item active">
        <a class="nav-link" href="{% url 'dashboard:index' %}">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Trang chính</span>
        </a>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- Heading -->
    <div class="sidebar-heading">
        Quản lý người dùng
    </div>

    <!-- Nav Item - Users -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUsers"
            aria-expanded="false" aria-controls="collapseUsers">
            <i class="fas fa-fw fa-users"></i>
            <span>Người dùng</span>
        </a>
        <div id="collapseUsers" class="collapse" aria-labelledby="headingUsers"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Quản lý người dùng:</h6>
                <a class="collapse-item" href="{% url 'dashboard:user_list' %}">Danh sách</a>
                <a class="collapse-item" href="{% url 'dashboard:user_dashboard' %}">Thống kê</a>
                <a class="collapse-item" href="{% url 'dashboard:user_add' %}">Thêm mới</a>
            </div>
        </div>
    </li>

    <!-- Nav Item - Messaging -->
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:messaging' %}">
            <i class="fas fa-fw fa-comment-dots"></i>
            <span>Nhắn tin</span>
        </a>
    </li>
    
    <!-- Nav Item - Warranty -->
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:warranty' %}">
            <i class="fas fa-fw fa-shield-alt"></i>
            <span>Bảo hành</span>
        </a>
    </li>

    <!-- Nav Item - Subscription Management -->
    <li class="nav-item">
        <a class="nav-link" href="{% url 'dashboard:subscription_list' %}">
            <i class="fas fa-fw fa-sync-alt"></i>
            <span>Quản lý Gia hạn</span>
        </a>
    </li>
    
    <!-- Nav Item - Source Management -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSources"
            aria-expanded="false" aria-controls="collapseSources">
            <i class="fas fa-fw fa-database"></i>
            <span>Nhà cung cấp</span>
        </a>
        <div id="collapseSources" class="collapse" aria-labelledby="headingSources"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Quản lý nguồn nhập:</h6>
                <a class="collapse-item" href="{% url 'dashboard:source_list' %}">Danh sách</a>
                <a class="collapse-item" href="{% url 'dashboard:compare_sources' %}">So sánh nguồn</a>
                <a class="collapse-item" href="{% url 'dashboard:source_add' %}">Thêm mới</a>
                <a class="collapse-item" href="{% url 'dashboard:source_log_list' %}">Nhật ký</a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- Heading -->
    <div class="sidebar-heading">
        Cửa hàng
    </div>

    <!-- Nav Item - Products Collapse Menu -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseProducts"
            aria-expanded="false" aria-controls="collapseProducts">
            <i class="fas fa-fw fa-box"></i>
            <span>Sản phẩm</span>
        </a>
        <div id="collapseProducts" class="collapse" aria-labelledby="headingProducts"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Quản lý sản phẩm:</h6>
                <a class="collapse-item" href="/dashboard/products/">Danh sách</a>
                <a class="collapse-item" href="/dashboard/products/categories/">Danh mục</a>
                <a class="collapse-item" href="/dashboard/products/add/">Thêm mới</a>
            </div>
        </div>
    </li>

    <!-- Nav Item - Orders -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseOrders"
            aria-expanded="false" aria-controls="collapseOrders">
            <i class="fas fa-fw fa-shopping-cart"></i>
            <span>Đơn hàng</span>
        </a>
        <div id="collapseOrders" class="collapse" aria-labelledby="headingOrders"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Quản lý đơn hàng:</h6>
                <a class="collapse-item" href="{% url 'dashboard:order_management' %}">Tất cả đơn hàng</a>
                <a class="collapse-item" href="{% url 'dashboard:order_management' %}?status=pending">Chờ xử lý</a>
                <a class="collapse-item" href="{% url 'dashboard:export_orders' %}">Xuất báo cáo</a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- Heading -->
    <div class="sidebar-heading">
        Marketing
    </div>

    <!-- Nav Item - Marketing -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseMarketing"
            aria-expanded="true" aria-controls="collapseMarketing">
            <i class="fas fa-fw fa-bullhorn"></i>
            <span>Marketing</span>
        </a>
        <div id="collapseMarketing" class="collapse" aria-labelledby="headingMarketing"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Công cụ Marketing:</h6>
                <a class="collapse-item" href="{% url 'dashboard:marketing' %}">Chiến dịch</a>
                <a class="collapse-item" href="{% url 'dashboard:discounts' %}">Mã giảm giá</a>
                <a class="collapse-item" href="{% url 'dashboard:banners' %}">Banner</a>
            </div>
        </div>
    </li>

    <!-- Nav Item - Chatbot Menu -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseChatbot"
            aria-expanded="true" aria-controls="collapseChatbot">
            <i class="fas fa-robot"></i>
            <span>Chatbot</span>
        </a>
        <div id="collapseChatbot" class="collapse" aria-labelledby="headingChatbot" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Quản lý Chatbot:</h6>
                <a class="collapse-item" href="{% url 'dashboard:chatbot_dashboard' %}">Tổng quan</a>
                <a class="collapse-item" href="{% url 'dashboard:chatbot_settings' %}">Cấu hình</a>
                <a class="collapse-item" href="{% url 'dashboard:chat_history' %}">
                    <i class="fas fa-history fa-sm fa-fw mr-1"></i>
                    Lịch sử trò chuyện
                </a>
            </div>
        </div>
    </li>

    <!-- Add this to your sidebar navigation -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSettings" aria-expanded="false" aria-controls="collapseSettings">
            <i class="fas fa-cogs"></i>
            <span>Cài đặt hệ thống</span>
        </a>
        <div id="collapseSettings" class="collapse" aria-labelledby="headingSettings" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">Tùy chọn cài đặt:</h6>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=general">Cài đặt chung</a>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=email">Cấu hình Email</a>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=payment">Cổng thanh toán</a>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=chatbot">Cấu hình Chatbot</a>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=security">Bảo mật</a>
                <a class="collapse-item" href="{% url 'dashboard:settings' %}?tab=backup">Sao lưu & Phục hồi</a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider d-none d-md-block">

    <!-- Sidebar Toggler (Sidebar) -->
    <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle">
            <i class="fas fa-angle-left text-white"></i>
        </button>
    </div>

</ul>
<!-- End of Sidebar -->

<!-- CSS cho hiệu ứng đẹp hơn -->
<style>
    /* Reset toàn bộ CSS sidebar và bắt đầu lại */
    .sidebar {
        position: fixed !important;
        top: 0;
        left: 0;
        height: 100vh;
        width: 225px;
        z-index: 1040;
        overflow-y: auto;
        background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);
        display: block;
    }
    
    /* Reset lại nội dung của sidebar */
    #accordionSidebar {
        display: flex;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }
    
    /* Đảm bảo các nav-item hiển thị dọc */
    .sidebar .nav-item {
        display: block;
        width: 100%;
    }
    
    /* Đảm bảo link trong sidebar hiển thị đúng */
    .sidebar .nav-link {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        color: rgba(255, 255, 255, 0.8);
        text-align: left;
    }
    
    /* Đảm bảo phần nội dung chính không bị đè */
    #content-wrapper {
        margin-left: 225px;
        width: calc(100% - 225px);
    }
    
    /* Xử lý khi sidebar được thu gọn */
    body.sidebar-toggled .sidebar {
        width: 6.5rem !important;
    }
    
    body.sidebar-toggled #content-wrapper {
        margin-left: 6.5rem;
        width: calc(100% - 6.5rem);
    }
    
    /* Đảm bảo sub-menu hiển thị đúng */
    .sidebar .collapse {
        position: relative;
        left: 0;
        display: none;
    }
    
    .sidebar .collapse.show {
        display: block;
    }
    
    /* Responsive mode */
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        body.sidebar-toggled .sidebar {
            transform: translateX(0);
        }
        
        #content-wrapper {
            margin-left: 0;
            width: 100%;
        }
    }

    /* Sidebar animation và hover effects */
    .hover-effect:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
        transition: all 0.3s ease;
    }
    
    .hover-subtle:hover {
        background: rgba(78, 115, 223, 0.1);
        color: #4e73df;
        transform: translateX(3px);
        transition: all 0.2s ease;
    }
    
    .fa-spin-hover:hover {
        animation: fa-spin 2s infinite linear;
    }
    
    .sidebar-heading {
        letter-spacing: 1px;
        font-weight: 700;
    }
    
    .pulse-link {
        position: relative;
        overflow: hidden;
    }
    
    .pulse-badge {
        animation: pulse-animation 2s infinite;
    }
    
    @keyframes pulse-animation {
        0% {
            box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        }
    }
    
    .shadow-pulse {
        animation: shadow-pulse 2s infinite;
        transition: all 0.3s ease;
    }
    
    @keyframes shadow-pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3);
        }
        70% {
            box-shadow: 0 0 0 5px rgba(255, 255, 255, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
        }
    }
    
    .sidebar-card {
        background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
        color: white;
        margin: 1rem;
        border-radius: 0.5rem;
        padding: 1rem;
        transition: all 0.3s ease;
    }
    
    .sidebar-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .sidebar-card-illustration {
        max-width: 60px;
        margin: 0 auto;
        filter: drop-shadow(0px 3px 3px rgba(0, 0, 0, 0.2));
    }
    
    #sidebarToggle {
        position: relative;
        transition: all 0.3s ease;
    }
    
    #sidebarToggle:hover {
        background-color: white;
        color: #4e73df;
        transform: scale(1.1);
    }
    
    #accordionSidebar {
        background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);
        background-size: cover;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .sidebar-brand {
        height: 5rem;
        transition: all 0.3s ease;
    }
    
    .sidebar-brand:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .collapse-inner {
        border-left: 3px solid #4e73df;
        transition: all 0.3s ease;
    }
    
    .collapse-header {
        font-weight: 700;
        letter-spacing: 0.05rem;
    }

    /* Thêm hiệu ứng biến đổi cho menu items */
    .nav-item {
        transition: background-color 0.3s ease, transform 0.3s ease;
        position: relative;
    }

    .nav-item:hover::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 4px;
        background: linear-gradient(180deg, #ffffff 0%, rgba(255,255,255,0.5) 100%);
        animation: slideIn 0.3s ease-in-out;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Badges tùy chỉnh */
    .badge {
        transition: all 0.3s ease;
    }

    .badge-info, .badge-light {
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .nav-item:hover .badge {
        transform: scale(1.1);
    }

    /* Menu dropdown animation */
    .collapse {
        transition: height 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    /* Sidebar dark mode toggle - có thể thêm nếu muốn */
    .theme-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
        margin: 15px auto;
    }

    .theme-switch input { 
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #1cc88a;
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    /* Cải thiện nút thu gọn sidebar */
    .sidebar-toggle {
        width: 2rem;
        height: 2rem;
        text-align: center;
        margin-bottom: 1rem;
        cursor: pointer;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        transition: all 0.3s ease;
    }
    
    .sidebar-toggle:hover {
        background-color: rgba(255, 255, 255, 0.2);
        color: #fff;
    }
    
    .sidebar-toggle i {
        font-size: 0.85rem;
        transition: transform 0.3s ease;
    }
    
    /* Xoay icon khi sidebar thu gọn */
    body.sidebar-toggled .sidebar-toggle i {
        transform: rotate(180deg);
    }
    
    /* Đảm bảo dropdown hiển thị đúng */
    .sidebar .collapse.show {
        display: block !important;
    }
    
    /* Đảm bảo dropdown không bị ẩn bởi các style khác */
    .sidebar .custom-dropdown.show {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    /* Đảm bảo dropdown hiển thị đúng khi sidebar thu gọn */
    .sidebar.toggled .nav-item:hover .collapse {
        display: block !important;
        position: absolute;
        left: 100%;
        top: 0;
        z-index: 1000;
        min-width: 200px;
        border-radius: 0.35rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        background-color: #fff;
    }
    
    /* Đảm bảo dropdown hiển thị đúng */
    .sidebar .collapse.show {
        display: block !important;
    }
    
    /* Đảm bảo dropdown không bị ẩn bởi các style khác */
    .sidebar .collapse-inner {
        padding: 0.5rem 0;
        min-width: 10rem;
        font-size: 0.85rem;
        background-color: #fff;
        border-radius: 0.35rem;
    }
    
    /* Đảm bảo các item trong dropdown hiển thị đúng */
    .sidebar .collapse-item {
        display: block;
        width: 100%;
        padding: 0.7rem 1rem;
        margin: 0 0.5rem;
        color: #3a3b45;
        text-align: left;
        border-radius: 0.35rem;
    }
    
    /* Hiệu ứng hover cho các item trong dropdown */
    .sidebar .collapse-item:hover {
        background-color: #eaecf4;
    }

    /* Cải thiện hiển thị icon mũi tên */
    .dropdown-indicator {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        transition: all 0.3s ease;
        font-size: 0.8rem;
        opacity: 0.7;
    }
    
    /* Xoay và làm nổi bật icon mũi tên khi dropdown được mở */
    .dropdown-indicator.open {
        transform: translateY(-50%) rotate(90deg);
        opacity: 1;
    }
    
    /* Cải thiện hiển thị của các tab có dropdown */
    .sidebar .nav-link[data-target] {
        position: relative;
        padding-right: 2rem;
    }
    
    /* Cải thiện hiển thị của dropdown */
    .sidebar .collapse {
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        margin-left: 1.75rem;
        padding-left: 0.5rem;
        transition: all 0.3s ease;
    }
    
    /* Cải thiện hiển thị của các item trong dropdown */
    .sidebar .collapse-item {
        display: block;
        width: calc(100% - 1rem);
        padding: 0.6rem 1rem;
        margin: 0.2rem 0.5rem;
        color: #3a3b45;
        text-align: left;
        border-radius: 0.35rem;
        transition: all 0.2s ease;
        font-weight: 400;
        font-size: 0.85rem;
        border-left: 3px solid transparent;
    }
    
    /* Hiệu ứng hover mượt mà hơn cho các item trong dropdown */
    .sidebar .collapse-item:hover {
        background-color: rgba(78, 115, 223, 0.1);
        color: #4e73df;
        border-left: 3px solid #4e73df;
        transform: translateX(3px);
    }
    
    /* Hiệu ứng active cho item đang được chọn */
    .sidebar .collapse-item.active {
        background-color: rgba(78, 115, 223, 0.2);
        color: #4e73df;
        border-left: 3px solid #4e73df;
        font-weight: 600;
    }
    
    /* Cải thiện hiển thị của collapse-inner */
    .sidebar .collapse-inner {
        padding: 0.5rem 0;
        border-radius: 0.35rem;
        background-color: #fff;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    }
    
    /* Cải thiện hiển thị của collapse-header */
    .sidebar .collapse-header {
        margin: 0;
        white-space: nowrap;
        padding: 0.5rem 1.5rem;
        text-transform: uppercase;
        font-size: 0.65rem;
        font-weight: 700;
        color: #b7b9cc;
        letter-spacing: 0.05rem;
    }

    /* Ẩn mũi tên khi sidebar thu gọn */
    .sidebar.toggled .dropdown-indicator {
        display: none;
    }
</style>

<script>
$(document).ready(function() {
    // Xóa nút thu gọn cũ nếu đã tồn tại
    $('.sidebar-toggle').remove();
    
    // Thay thế nút sidebarToggle hiện tại bằng nút mới
    $('#sidebarToggle').replaceWith('<div class="sidebar-toggle" id="customSidebarToggle"><i class="fas fa-angle-left"></i></div>');
    
    // Xử lý sự kiện click vào nút thu gọn
    $('#customSidebarToggle').on('click', function() {
        $('body').toggleClass('sidebar-toggled');
        $('.sidebar').toggleClass('toggled');
        
        // Lưu trạng thái vào localStorage
        if ($('.sidebar').hasClass('toggled')) {
            localStorage.setItem('sidebar-toggle', 'true');
            // Ẩn tất cả dropdown khi thu gọn sidebar
            $('.sidebar .collapse.show').removeClass('show');
            $('.sidebar .nav-link').addClass('collapsed');
            $('.sidebar .nav-link .dropdown-indicator').removeClass('open');
        } else {
            localStorage.setItem('sidebar-toggle', 'false');
            // Khôi phục dropdown đã lưu nếu có
            const savedDropdown = localStorage.getItem('sidebar-dropdown');
            if (savedDropdown) {
                $(savedDropdown).addClass('show');
                const $navLink = $(`[data-target="${savedDropdown}"]`);
                $navLink.removeClass('collapsed');
                $navLink.find('.dropdown-indicator').addClass('open');
            }
        }
    });
    
    // Khôi phục trạng thái thu gọn từ localStorage
    if (localStorage.getItem('sidebar-toggle') === 'true') {
        $('body').addClass('sidebar-toggled');
        $('.sidebar').addClass('toggled');
    } else {
        // Khôi phục dropdown đã lưu nếu sidebar không thu gọn
        const savedDropdown = localStorage.getItem('sidebar-dropdown');
        if (savedDropdown) {
            $(savedDropdown).addClass('show');
            const $navLink = $(`[data-target="${savedDropdown}"]`);
            $navLink.removeClass('collapsed');
            $navLink.find('.dropdown-indicator').addClass('open');
        }
    }
    
    // Thêm icon mũi tên cho các tab có dropdown
    $('.sidebar .nav-link[data-toggle="collapse"]').append('<i class="fas fa-angle-right dropdown-indicator"></i>');
    
    // Xử lý dropdown menu bằng cách thêm sự kiện click trực tiếp
    $('.sidebar .nav-link[data-toggle="collapse"]').each(function() {
        const $this = $(this);
        const targetId = $this.attr('data-target');
        
        // Xóa thuộc tính data-toggle để ngăn Bootstrap xử lý
        $this.removeAttr('data-toggle');
        
        // Thêm sự kiện click trực tiếp
        $this.on('click', function(e) {
            e.preventDefault();
            
            // Đóng tất cả các dropdown khác
            $('.sidebar .collapse.show').not(targetId).removeClass('show');
            $('.sidebar .nav-link').not($this).addClass('collapsed');
            $('.sidebar .nav-link .dropdown-indicator').removeClass('open');
            
            // Toggle class show cho target
            $(targetId).toggleClass('show');
            
            // Toggle class collapsed cho nav-link
            $this.toggleClass('collapsed');
            
            // Toggle class open cho icon mũi tên
            $this.find('.dropdown-indicator').toggleClass('open');
            
            // Lưu trạng thái vào localStorage
            if ($(targetId).hasClass('show')) {
                localStorage.setItem('sidebar-dropdown', targetId);
            } else {
                localStorage.removeItem('sidebar-dropdown');
            }
        });
    });
    
    // Khi hover vào nav-item khi sidebar đã thu gọn
    $('.sidebar.toggled .nav-item').hover(
        function() {
            // Hiển thị dropdown khi hover
            $(this).find('.collapse').addClass('show');
        },
        function() {
            // Ẩn dropdown khi không hover
            $(this).find('.collapse').removeClass('show');
        }
    );
    
    // Đóng dropdown khi click ra ngoài
    $(document).on('click', function(e) {
        if (!$(e.target).closest('.sidebar').length) {
            $('.sidebar .collapse.show').removeClass('show');
            $('.sidebar .nav-link').addClass('collapsed');
            $('.sidebar .nav-link .dropdown-indicator').removeClass('open');
            localStorage.removeItem('sidebar-dropdown');
        }
    });
    
    // Đánh dấu menu item hiện tại là active
    const currentPath = window.location.pathname;
    $('.sidebar .collapse-item').each(function() {
        const href = $(this).attr('href');
        if (href === currentPath) {
            $(this).addClass('active');
            $(this).closest('.collapse').addClass('show');
            $(this).closest('.nav-item').find('.nav-link').removeClass('collapsed');
            $(this).closest('.nav-item').find('.dropdown-indicator').addClass('open');
        }
    });
});
</script> 