{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <title>TomOi.vn - Phần mềm bản quyền</title>
  <link href="{% static 'css/style.css' %}?v=1.1" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4/bootstrap-4.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
</head>
<body>
<nav class="navbar navbar-expand-lg">
      <!-- Logo -->
      <a class="navbar-brand" href="{% url 'store:home' %}">
          <img alt="Logo" src="https://placehold.co/40x40"/>
      </a>
      
        <!-- Menu button -->
        <div class="nav-item">
          <a class="menu-link" href="#">
              <i class="fas fa-bars"></i> Danh mục
          </a>
      </div>

        <!-- Search bar -->
        <div class="search-bar">
            <input placeholder="Tìm kiếm sản phẩm..." type="text"/>
            <button type="button">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <ul class="navbar-nav ms-auto">
        <!-- Replace the user nav item section -->
        <li class="nav-item">
          <a class="nav-link" href="#"><i class="fas fa-heart"></i></a>
      </li>

      <li class="nav-item">
        <a class="nav-link user-icon" href="#">
            {% if user.is_authenticated %}
                {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" alt="Avatar">
                {% else %}
                    <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar">
                {% endif %}
            {% else %}
                <i class="fa fa-user"></i>
            {% endif %}
        </a>
        <div class="dropdown-content">
            {% if user.is_authenticated %}
                <p class="username">
                    <i class="fas fa-user"></i>
                    <span>{{ user.username }}</span>
                </p>
                <a href="#" class="dropdown-item">
                    <i class="fas fa-wallet"></i> Số dư: <b> {{ user.balance|default:"0" }}</b>đ
                </a>
                <a href="{% url 'accounts:user_info' %}" class="dropdown-item">
                    <i class="fas fa-user-cog"></i> Thông tin tài khoản
                </a>
                <a href="{% url 'accounts:security' %}" class="dropdown-item">
                    <i class="fas fa-shield-alt"></i> Bảo mật
                </a>
                <a href="/store/order-history/" class="dropdown-item">
                    <i class="fas fa-history"></i> Lịch sử mua hàng
                </a>
                <a href="{% url 'accounts:logout' %}" class="dropdown-item">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </a>
            {% else %}
                <a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#authModal">
                    <i class="fas fa-sign-in-alt"></i> Đăng nhập / Đăng ký
                </a>
            {% endif %}
        </div>
    </li>
<!-- Giỏ hàng dropdown -->
<li class="nav-item dropdown">
  <form method="post" id="cartForm">
      {% csrf_token %}
      <button type="button" class="btn btn-dark dropdown-toggle" id="cartDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fas fa-shopping-cart"></i> Giỏ hàng
      </button>
<!-- Update cart dropdown -->
<ul class="dropdown-menu p-3" id="cart-dropdown">
  <li><strong>Giỏ hàng ({{ cart_items|length|default:"0" }})</strong></li>
  <li id="cart-items-list">
    {% if cart_items %}
        {% for item in cart_items %}
        <div class="cart-item-card">
            <!-- Card content -->
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center text-muted py-4">
            <i class="fas fa-shopping-cart fa-2x mb-3"></i>
            <p>Bạn chưa chọn sản phẩm nào cả</p>
        </div>
    {% endif %}
</li>
  <li><hr class="dropdown-divider"></li>
<div class="cart-buttons">
    <button type="submit" formaction="{% url 'store:cart' %}" class="btn btn-dark">
        <i class="fa fa-shopping-cart"></i> Xem giỏ hàng
    </button>
    <button type="submit" formaction="{% url 'store:cart' %}" class="btn btn-light">
        <i class="fa fa-credit-card"></i> Thanh toán
    </button>
</div>
</ul>
  </form>
</li>

        </ul>
    </div>
</nav>

<!-- Modal Đăng Nhập -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <!-- Logo trên cùng -->
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đăng Nhập</h5>
        <form id="loginForm" method="post" action="{% url 'accounts:login' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="loginUsername" class="form-label">Tên đăng nhập</label>
            <input type="text" class="form-control" id="loginUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Mật khẩu</label>
            <input type="password" class="form-control" id="loginPassword" name="password" required>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="rememberMe" name="remember_me">
              <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
            </div>
            <a href="#" id="forgotPasswordLink" class="text-decoration-none" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#forgotPasswordModal">
              Quên mật khẩu?
            </a>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
        </form>
        <div class="text-center my-3">
          <span>HOẶC</span>
        </div>
        <div class="d-grid gap-2">
          <a href="{% url 'social:begin' 'google-oauth2' %}" class="btn btn-danger">
            <i class="fab fa-google me-2"></i>Đăng nhập với Google
        </a>
        </div>
        <div class="text-center mt-3">
          <span>Bạn chưa có tài khoản? <a href="#" id="registerLink" class="text-decoration-none" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#registerModal">Đăng ký ngay</a></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Quên Mật Khẩu -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Quên Mật Khẩu</h5>
        <form id="forgotPasswordForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="forgotEmail" class="form-label">Email</label>
            <div class="input-group">
              <input type="email" class="form-control" id="forgotEmail" name="email" required>
              <button class="btn btn-outline-secondary" type="button" id="editEmailBtn">
                <i class="fas fa-pencil-alt"></i>
              </button>
            </div>
          </div>
          <button type="button" class="btn btn-primary w-100" id="sendOtpBtn">Gửi mã xác nhận</button>
        </form>
        <div class="text-center mt-3">
          <a href="#" class="text-decoration-none" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#authModal">
            Quay lại đăng nhập
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Verify OTP -->
<div class="modal fade" id="verifyOtpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5 class="text-center">Xác minh OTP</h5>
                <p class="text-center mb-3">
                    Mã xác nhận đã được gửi đến email: 
                    <span id="displayEmail" class="fw-bold"></span>
                    <a href="#" id="editEmailLink" class="ms-2 text-decoration-none">
                        <i class="fas fa-pencil-alt"></i> Chỉnh sửa
                    </a>
                </p>
                <form id="verifyOtpForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Nhập mã xác nhận</label>
                        <div id="otpInputs" class="d-flex gap-2">
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="verifyOtpBtn">Xác minh</button>
                </form>
                <div class="text-center mt-3">
                    <span>Bạn chưa nhận được mã? 
                        <button type="button" id="resendOtpBtn" class="btn btn-link p-0">Gửi lại</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Thêm script để đếm ngược -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var resendBtn = document.getElementById('resendOtpBtn');
    var countdown = 30;
    var interval;

    function startCountdown() {
      resendBtn.disabled = true;
      resendBtn.textContent = `Gửi lại (${countdown} giây)`;
      interval = setInterval(function() {
        countdown--;
        if (countdown > 0) {
          resendBtn.textContent = `Gửi lại (${countdown} giây)`;
        } else {
          clearInterval(interval);
          resendBtn.disabled = false;
          resendBtn.textContent = 'Gửi lại';
          countdown = 30;  // Reset lại 30 giây cho lần sau
        }
      }, 1000);
    }

    resendBtn.addEventListener('click', function() {
      // Gọi hàm gửi lại OTP tại đây (ví dụ: AJAX request)
      // ...

      // Khởi động lại đếm ngược
      startCountdown();
    });

    // Khởi động đếm ngược khi modal mở
    var verifyOtpModal = document.getElementById('verifyOtpModal');
    verifyOtpModal.addEventListener('shown.bs.modal', function () {
      startCountdown();
    });
  });
</script>

<!-- Modal Đặt Password mới -->
<div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đặt Lại Mật Khẩu</h5>
        <form id="resetPasswordForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="newPassword" class="form-label">Mật khẩu mới</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" required>
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Xác nhận mật khẩu</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đặt lại mật khẩu</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Đăng Ký -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đăng Ký</h5>
        <form id="registerForm" method="post" action="{% url 'accounts:register' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="registerEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="registerEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="registerUsername" class="form-label">Tên đăng nhập</label>
            <input type="text" class="form-control" id="registerUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label for="registerPassword" class="form-label">Mật khẩu</label>
            <input type="password" class="form-control" id="registerPassword" name="password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đăng ký</button>
        </form>
      </div>
    </div>
  </div>
</div>


  <div class="container mt-4 content">
    {% block content %}
    <!-- Nội dung trang con sẽ kế thừa và thay thế phần này -->
    {% endblock %}
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2><b>TomOi.vn</b></h2>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
          </div>
          <br>
          <h5 class="mt-3"><b>LIÊN HỆ</b></h5>
          <ul class="list-unstyled">
            <li><a href="#">Zalo</a></li>
            <li><a href="#">Email</a></li>
            <li><a href="#">Hotline</a></li>
          </ul>
        </div>

        <div class="col-md-3">
          <h5><b>GIỚI THIỆU</b></h5>
          <br>
          <ul class="list-unstyled">
            <li><a href="#">Quy định mua hàng</a></li>
            <li><a href="#">Hướng dẫn mua hàng</a></li>
            <li><a href="#">Thủ thuật &amp; Tin tức </a></li>
            <li><a href="#">Tra cứu bảo hành</a></li>
            <li><a href="#">Câu hỏi thường gặp</a></li>
            <li><a href="#">Chính sách bảo hành</a></li>
            <li><a href="#">Hình thức thanh toán</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5><b>CHƯƠNG TRÌNH</b></h5>
          <br>
          <ul class="list-unstyled"> 
            <li><a href="#">Đăng ký làm Cộng Tác Viên</a></li>
            <li><a href="#">Đăng ký làm Đối Tác</a></li>
            <li><a href="#">Giới thiệu bạn bè</a></li>
            <li><a href="#">Đổi Mail - Nhận tiền</a></li>
            <li><a href="#">Nhận tài khoản miễn phí</a></li>
            <li><a href="#">Tuyển dụng</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5><b>HỖ TRỢ THANH TOÁN</b></h5>
          <br>
          <div class="payment-icons">
            <img alt="Visa" src="https://placehold.co/50x30"/>
            <img alt="Mastercard" src="https://placehold.co/50x30"/>
            <img alt="JCB" src="https://placehold.co/50x30"/>
            <img alt="AMEX" src="https://placehold.co/50x30"/>
            <img alt="VNPay" src="https://placehold.co/50x30"/>
            <img alt="ZaloPay" src="https://placehold.co/50x30"/>
            <img alt="Napas" src="https://placehold.co/50x30"/>
            <img alt="Kredivo" src="https://placehold.co/50x30"/>
            <img alt="Momo" src="https://placehold.co/50x30"/>
            <img alt="Foxpay" src="https://placehold.co/50x30"/>
            <img alt="ViettelPay" src="https://placehold.co/50x30"/>
            <img alt="HomePayLater" src="https://placehold.co/50x30"/>
            <img alt="ApplePay" src="https://placehold.co/50x30"/>
            <img alt="SamsungPay" src="https://placehold.co/50x30"/>
            <img alt="GooglePay" src="https://placehold.co/50x30"/>
          </div>
          <h5 class="mt-3"><b>CHỨNG NHẬN</b></h5>
          <div class="certification-icons">
            <img alt="DMCA" src="https://placehold.co/100x30"/>
            <img alt="Bộ Công Thương" src="https://placehold.co/100x30"/>
            <img alt="ISO Certification" src="https://placehold.co/100x30"/>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <hr>
      <p>© Copyright 2024 <b>TomOi.vn</b> – All rights reserved.</p>
  </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  {% if request.resolver_match.app_name == 'store' %}
    <script src="{% static 'js/cart.js' %}" defer></script>
  {% endif %}
  <script src="{% static 'js/auth.js' %}" defer></script>
  {% block extra_js %}{% endblock %}
</body>
</html>
