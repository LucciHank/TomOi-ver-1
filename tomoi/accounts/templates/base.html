{% load static %}
{% load custom_filters %}
{% load cart_tags %}

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="author" content="Đỗ Hoàng Anh">
  <meta name="keywords" content="netflix, prime, disney, hbo, hulu, apple tv, amazon prime, disney plus, hbo max, apple tv+, amazon prime video, disney+,
  spotify,pornhub,ai, premium, phần mềm bản quyền, phần mềm miễn phí, phần mềm giải trí, phần mềm làm việc, phần mềm học tập, phần mềm game, phần mềm edit ảnh,
  phần mềm edit video, phần mềm window, phần mềm office, phần mềm google drive, phần mềm steam wallet, phần mềm diệt virus, phần mềm xbox,
  phần mềm itunes gift card,">
  <meta name="description" content="">
  <title>TomOi.vn - Phần Mềm Bản Quyền Chính Hãng | Tài Khoản Premium</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  
  <!-- Base CSS -->
  <link href="{% static 'css/style.css' %}?v=1.1" rel="stylesheet"/>
  <link href="{% static 'css/security.css' %}?v=1.1" rel="stylesheet"/>
  <link href="{% static 'store/css/home.css' %}?v=1.1" rel="stylesheet"/>
  

  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  
  <!-- Google Translate -->
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'vi',
        includedLanguages: 'en,vi,zh-CN,ko,ja',
        autoDisplay: false,
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  
  <!-- Allow child templates to add their own CSS -->
  {% block page_css %}{% endblock %}

  <!-- SEO Meta Tags -->
  <meta name="description" content="TomOi.vn - Nền tảng cung cấp phần mềm bản quyền, tài khoản premium Netflix, Spotify, Disney+, HBO, Office 365 uy tín hàng đầu Việt Nam. Thanh toán an toàn, kích hoạt tức thì, hỗ trợ 24/7.">
  <meta name="keywords" content="phần mềm bản quyền, tài khoản premium, netflix việt nam, spotify premium, disney plus, hbo go, microsoft office, windows bản quyền, phần mềm diệt virus, phần mềm làm việc, phần mềm học tập, phần mềm giải trí, steam wallet, google drive, apple id, pornhub premium, tài khoản streaming, phần mềm chỉnh sửa ảnh, phần mềm edit video">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="TomOi.vn - Phần Mềm Bản Quyền Chính Hãng | Tài Khoản Premium">
  <meta property="og:description" content="Nền tảng cung cấp phần mềm bản quyền và tài khoản premium uy tín hàng đầu Việt Nam">
  <meta property="og:image" content="{% static 'images/og-image.jpg' %}">
  <meta property="og:url" content="https://tomoi.vn">
  
  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="TomOi.vn - Phần Mềm Bản Quyền Chính Hãng">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="robots" content="index, follow">
  <meta name="author" content="TomOi.vn">
  <meta name="language" content="Vietnamese">
  <link rel="canonical" href="https://tomoi.vn{{ request.path }}">

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Thêm favicon -->
  <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}"/>
</head>
<body data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}">
  <!-- Google Translate Element -->
  <div id="google_translate_element" style="position: fixed; top: 10px; right: 10px; z-index: 9999;"></div>

  {% csrf_token %}

<nav class="navbar navbar-expand-lg">
      <!-- Logo -->
      <a class="navbar-brand" href="{% url 'store:home' %}">
          <img alt="Logo" src="https://placehold.co/40x40"/>
      </a>
      
        <!-- Menu button -->
        <div class="nav-menu-item">
          <button class="category-button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-list"></i>
            Danh mục
          </button>
          <ul class="dropdown-menu category-list">
            {% for category in categories %}
            <li>
                <a class="dropdown-item" href="{% url 'store:category_detail' category.slug %}">
                    <i class="{{ category.icon_class|default:'fas fa-folder' }}"></i>
                    {{ category.name }}
                </a>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>

        <!-- Search bar -->
        <div class="search-bar">
            <input placeholder="Tìm kiếm sản phẩm..." type="text"/>
            <button type="button">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <ul class="navbar-nav ms-auto">
            <!-- Favorite -->
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-heart" style="color: white !important;"></i></a>
            </li>

            <!-- User Icon -->
            <li class="nav-item">
                <a class="nav-link user-icon" href="#">
                    {% if user.is_authenticated %}
                        {% if user.avatar %}
                            <img src="{{ user.avatar.url }}" alt="Avatar">
                        {% else %}
                            <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar">
                        {% endif %}
                    {% else %}
                        <i class="fa fa-user"></i>
                    {% endif %}
                </a>
                <div class="dropdown-content">
                    {% if user.is_authenticated %}
                        <p class="username">
                            <i class="fas fa-user"></i>
                            <span>{{ user.username }}</span>
                        </p>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-wallet"></i> Số dư: <b>{{ user.balance|format_balance }}</b>
                        </a>
                        <a href="{% url 'accounts:user_info' %}" class="dropdown-item">
                            <i class="fas fa-user-cog"></i> Thông tin tài khoản
                        </a>
                        <a href="{% url 'accounts:security' %}" class="dropdown-item">
                            <i class="fas fa-shield-alt"></i> Bảo mật
                        </a>
                        <a href="/store/user-info/order-history/" class="dropdown-item">
                            <i class="fas fa-history"></i> Sản phẩm đã mua
                        </a>
                        <a href="{% url 'accounts:logout' %}" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i> Đăng xuất
                        </a>
                    {% else %}
                        <a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#authModal">
                            <i class="fas fa-sign-in-alt"></i> Đăng nhập / Đăng ký
                        </a>
                    {% endif %}
                </div>
            </li>

            <!-- Cart -->
            <li class="nav-item cart-wrapper">
                <button class="cart-button">
                    <i class="fas fa-shopping-cart"></i>
                    Giỏ hàng
                    <span class="cart-count-badge" style="display: none;">0</span>
                </button>
                <div class="cart-dropdown-content">
                    <div class="cart-items">
                        {% for item in cart_items %}
                        <div class="cart-item" data-id="{{ item.id }}" data-stock="{{ item.stock }}">
                            <div class="item-controls">
                                <div class="quantity-controls">
                                    <button class="quantity-btn minus" data-id="{{ item.id }}">-</button>
                                    <input type="number" class="quantity-input" value="{{ item.quantity }}" min="1" max="{{ item.stock }}" readonly>
                                    <button class="quantity-btn plus" data-id="{{ item.id }}">+</button>
                                </div>
                                <button class="remove-btn" data-id="{{ item.id }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="empty-cart" style="display: none;">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Bạn chưa có sản phẩm nào trong giỏ hàng</p>
                    </div>
                    <div class="cart-total">
                        <span>Tổng cộng:</span>
                        <span class="total-amount">0đ</span>
                    </div>
                    <div class="cart-footer">
                        <a href="{% url 'store:cart' %}" class="btn btn-primary">Xem giỏ hàng</a>
                        <a href="#" class="btn btn-checkout">Thanh toán ngay</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</nav>

<!-- Modal Đăng Nhập -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <!-- Logo trên cùng -->
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đăng Nhập</h5>
        <form id="loginForm" method="post" action="{% url 'accounts:login' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="loginUsername" class="form-label">Tên đăng nhập / Email</label>
            <input type="text" class="form-control" id="loginUsername" name="username" 
                   placeholder="Nhập tên đăng nhập hoặc email" required>
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Mật khẩu</label>
            <input type="password" class="form-control" id="loginPassword" name="password" required>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="rememberMe" name="remember_me">
              <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
            </div>
            <a href="#" id="forgotPasswordLink" class="text-decoration-none" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#forgotPasswordModal">
              Quên mật khẩu?
            </a>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
        </form>
        <div class="text-center my-3">
          <span>HOẶC</span>
        </div>
        <div class="d-grid gap-2">
          <a href="{% url 'social:begin' 'google-oauth2' %}" class="btn btn-danger">
            <i class="fab fa-google me-2"></i>Đăng nhập với Google
        </a>
        </div>
        <div class="text-center mt-3">
          <span>Bạn chưa có tài khoản? <a href="#" id="registerLink" class="text-decoration-none" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#registerModal">Đăng ký ngay</a></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Quên Mật Khẩu -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Quên Mật Khẩu</h5>
        <form id="forgotPasswordForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="forgotEmail" class="form-label">Email</label>
            <div class="input-group">
              <input type="email" class="form-control" id="forgotEmail" name="email" required>
              <button class="btn btn-outline-secondary" type="button" id="editEmailBtn">
                <i class="fas fa-pencil-alt"></i>
              </button>
            </div>
          </div>
          <button type="button" class="btn btn-primary w-100" id="sendOtpBtn">Gửi mã xác nhận</button>
        </form>
        <div class="text-center mt-3">
          <a href="#" class="text-decoration-none" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#authModal">
            Quay lại đăng nhập
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Verify OTP -->
<div class="modal fade" id="verifyOtpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5 class="text-center">Xác minh OTP</h5>
                <p class="text-center mb-3">
                    Mã xác nhận đã được gửi đến email: 
                    <span id="displayEmail" class="fw-bold"></span>
                    <a href="#" id="editEmailLink" class="ms-2 text-decoration-none">
                        <i class="fas fa-pencil-alt"></i> Chỉnh sửa
                    </a>
                </p>
                <form id="verifyOtpForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Nhập mã xác nhận</label>
                        <div id="otpInputs" class="d-flex gap-2">
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                            <input type="text" maxlength="1" class="form-control otp-input" required>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="verifyOtpBtn">Xác minh</button>
                </form>
                <div class="text-center mt-3">
                    <span>Bạn chưa nhận được mã? 
                        <button type="button" id="resendOtpBtn" class="btn btn-link p-0">Gửi lại</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Thêm script để đếm ngược -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var resendBtn = document.getElementById('resendOtpBtn');
    var countdown = 30;
    var interval;

    function startCountdown() {
      resendBtn.disabled = true;
      resendBtn.textContent = `Gửi lại (${countdown} giây)`;
      interval = setInterval(function() {
        countdown--;
        if (countdown > 0) {
          resendBtn.textContent = `Gửi lại (${countdown} giây)`;
        } else {
          clearInterval(interval);
          resendBtn.disabled = false;
          resendBtn.textContent = 'Gửi lại';
          countdown = 30;  // Reset lại 30 giây cho lần sau
        }
      }, 1000);
    }

    resendBtn.addEventListener('click', function() {
      // Gọi hàm gửi lại OTP tại đây (ví dụ: AJAX request)
      // ...

      // Khởi động lại đếm ngược
      startCountdown();
    });

    // Khởi động đếm ngược khi modal mở
    var verifyOtpModal = document.getElementById('verifyOtpModal');
    verifyOtpModal.addEventListener('shown.bs.modal', function () {
      startCountdown();
    });
  });
</script>

<!-- Modal Đặt Password mới -->
<div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đặt Lại Mật Khẩu</h5>
        <form id="resetPasswordForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="newPassword" class="form-label">Mật khẩu mới</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" required>
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Xác nhận mật khẩu</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đặt lại mật khẩu</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Đăng Ký -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://placehold.co/50x50" alt="Logo Shop" class="me-auto">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="text-center">Đăng Ký</h5>
        <form id="registerForm" method="post" action="{% url 'accounts:register' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="registerEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="registerEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="registerUsername" class="form-label">Tên đăng nhập</label>
            <input type="text" class="form-control" id="registerUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label for="registerPassword" class="form-label">Mật khẩu</label>
            <input type="password" class="form-control" id="registerPassword" name="password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Đăng ký</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Thêm modal yêu cầu đăng nhập -->
<div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Yêu cầu đăng nhập</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Bạn cần đăng nhập hoặc đăng ký để thêm sản phẩm vào giỏ hàng.</p>
        <div class="d-grid gap-2">
          <button class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#authModal">
            <i class="fas fa-sign-in-alt"></i> Đăng nhập
          </button>
          <button class="btn btn-success" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerModal">
            <i class="fas fa-user-plus"></i> Đăng ký
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container mt-4 content">
    {% block content %}
    <!-- Nội dung trang con sẽ kế thừa và thay thế phần này -->
    {% endblock %}
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2><b>TomOi.vn</b></h2>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
          </div>
          <br>
          <h5 class="mt-3"><b>LIÊN HỆ</b></h5>
          <ul class="list-unstyled">
            <li><a href="#">Zalo</a></li>
            <li><a href="#">Email</a></li>
            <li><a href="#">Hotline</a></li>
          </ul>
        </div>

        <div class="col-md-3">
          <h5><b>GIỚI THIỆU</b></h5>
          <br>
          <ul class="list-unstyled">
            <li><a href="#">Quy định mua hàng</a></li>
            <li><a href="#">Hướng dẫn mua hàng</a></li>
            <li><a href="#">Thủ thuật &amp; Tin tức </a></li>
            <li><a href="#">Tra cứu bảo hành</a></li>
            <li><a href="#">Câu hỏi thường gặp</a></li>
            <li><a href="#">Chính sách bảo hành</a></li>
            <li><a href="#">Hình thức thanh toán</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5><b>CHƯƠNG TRÌNH</b></h5>
          <br>
          <ul class="list-unstyled"> 
            <li><a href="#">Đăng ký làm Cộng Tác Viên</a></li>
            <li><a href="#">Đăng ký làm Đối Tác</a></li>
            <li><a href="#">Giới thiệu bạn bè</a></li>
            <li><a href="#">Đổi Mail - Nhận tiền</a></li>
            <li><a href="#">Nhận tài khoản miễn phí</a></li>
            <li><a href="#">Tuyển dụng</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5><b>HỖ TRỢ THANH TOÁN</b></h5>
          <br>
          <div class="payment-icons">
            <img alt="Visa" src="https://placehold.co/50x30"/>
            <img alt="Mastercard" src="https://placehold.co/50x30"/>
            <img alt="JCB" src="https://placehold.co/50x30"/>
            <img alt="AMEX" src="https://placehold.co/50x30"/>
            <img alt="VNPay" src="https://placehold.co/50x30"/>
            <img alt="ZaloPay" src="https://placehold.co/50x30"/>
            <img alt="Napas" src="https://placehold.co/50x30"/>
            <img alt="Kredivo" src="https://placehold.co/50x30"/>
            <img alt="Momo" src="https://placehold.co/50x30"/>
            <img alt="Foxpay" src="https://placehold.co/50x30"/>
            <img alt="ViettelPay" src="https://placehold.co/50x30"/>
            <img alt="HomePayLater" src="https://placehold.co/50x30"/>
            <img alt="ApplePay" src="https://placehold.co/50x30"/>
            <img alt="SamsungPay" src="https://placehold.co/50x30"/>
            <img alt="GooglePay" src="https://placehold.co/50x30"/>
          </div>
          <h5 class="mt-3"><b>CHỨNG NHẬN</b></h5>
          <div class="certification-icons">
            <img alt="DMCA" src="https://placehold.co/100x30"/>
            <img alt="Bộ Công Thương" src="https://placehold.co/100x30"/>
            <img alt="ISO Certification" src="https://placehold.co/100x30"/>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <hr>
      <p>© Copyright 2024 <b>TomOi.vn</b> – All rights reserved.</p>
  </div>
  </footer>

  <!-- Load các thư viện JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Load base.js trước -->
<script src="{% static 'accounts/js/base.js' %}?v=1.2"></script>

<!-- Load các file JS khác sau -->
{% block extra_js %}{% endblock %}
</body>
</html>

